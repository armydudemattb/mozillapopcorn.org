/* This Source Code Form is subject to the terms of the MIT license
 * If a copy of the MIT license was not distributed with this file, you can
 * obtain one at http://www.mozillapopcorn.org/butter-license.txt */(function(){var e,t,n;(function(r){function f(e,t){if(e&&e.charAt(0)==="."&&t){t=t.split("/"),t=t.slice(0,t.length-1),e=t.concat(e.split("/"));var n,r;for(n=0;r=e[n];n++)if(r===".")e.splice(n,1),n-=1;else if(r===".."){if(n===1&&(e[2]===".."||e[0]===".."))break;n>0&&(e.splice(n-1,2),n-=2)}e=e.join("/")}return e}function l(e,t){return function(){return a.apply(r,o.call(arguments,0).concat([e,t]))}}function c(e){return function(t){return f(t,e)}}function h(e){return function(t){i[e]=t}}function p(e){if(s.hasOwnProperty(e)){var t=s[e];delete s[e],u.apply(r,t)}return i[e]}function d(e,t){var n,r,i=e.indexOf("!");return i!==-1?(n=f(e.slice(0,i),t),e=e.slice(i+1),r=p(n),r&&r.normalize?e=r.normalize(e,c(t)):e=f(e,t)):e=f(e,t),{f:n?n+"!"+e:e,n:e,p:r}}var i={},s={},o=[].slice,u,a;if(typeof n=="function")return;u=function(e,t,n,o){var u=[],a,f,c,v,m,g;o||(o=e);if(typeof n=="function"){!t.length&&n.length&&(t=["require","exports","module"]);for(v=0;v<t.length;v++){g=d(t[v],o),c=g.f;if(c==="require")u[v]=l(e);else if(c==="exports")u[v]=i[e]={},a=!0;else if(c==="module")f=u[v]={id:e,uri:"",exports:i[e]};else if(i.hasOwnProperty(c)||s.hasOwnProperty(c))u[v]=p(c);else{if(!g.p)throw e+" missing "+c;g.p.load(g.n,l(o,!0),h(c),{}),u[v]=i[c]}}m=n.apply(i[e],u),e&&(f&&f.exports!==r?i[e]=f.exports:a||(i[e]=m))}else e&&(i[e]=n)},e=a=function(e,t,n,i){return typeof e=="string"?p(d(e,t).f):(e.splice||(t.splice?(e=t,t=arguments[2]):e=[]),i?u(r,e,t,n):setTimeout(function(){u(r,e,t,n)},15),a)},a.config=function(){return a},t||(t=a),n=function(e,t,r){t.splice||(r=t,t=[]),n.unordered?s[e]=[e,t,r]:u(e,t,r)},n.amd={jQuery:!0}})(),n("../tools/almond",function(){}),function(){function e(){return!0}var t=function(){t.__waiting||(t.__waiting=[]),t.__waiting.push(arguments)};window.Butter||(window.Butter=t)}(),n("butter",function(){}),n("core/eventmanager",[],function(){function e(e){return e.listen&&e.unlisten}function t(t,n,r){if(!e(n))throw"Error: Object is not a valid event source: "+n;var i=r.length;while(i--)n.listen(r[i],t.dispatch)}function n(t,n,r){if(!e(n))throw"Error: Object is not a valid event source: "+n;var i=r.length;while(i--)n.unlisten(r[i],t.dispatch)}function r(e,t,n){var r,i;if(t[e]){r=t[e].slice(),i=r.length;while(i--)r[i](n)}}function i(e,t,n,i,s,o){var u,a,f;typeof n=="object"?(a={type:n.type,target:n.target,data:n.data},n=a.type):a={type:n+"",target:e,data:i},f=t+n,o=!0,o?r(f,s,a):(u=document.createEvent("CustomEvent"),u.initCustomEvent(f,!1,!1,a),document.dispatchEvent(u))}function s(e,t,n,r,i,s){var o,u;if(typeof n=="object")for(o in n)n.hasOwnProperty(o)&&e.listen(o,n[o]);else u=t+n,i[u]||(i[u]=[],document.addEventListener(u,function(e){s(u,e)},!1)),i[u].push(r)}function o(e,t,n,r,i,s){var o,u,a,f=t+n;if(typeof n=="object")for(a in n)n.hasOwnProperty(a)&&e.unlisten(a,n[a]);else{o=i[f];if(!o)return;r&&(u=o.indexOf(r),u>-1&&o.splice(u,1));if(!r||o.length===0)delete i[f],document.removeEventListener(f,function(e){s(f,e)},!1)}}function a(a){if(!a||e(a))return;var f={},l="butter-"+u++ +":",c=function(e,t){r(e,f,t.detail)};return a.chain=function(e,n){t(this,e,n)},a.unchain=function(e,t){n(this,e,t)},a.dispatch=function(e,t,n){i(this,l,e,t,f,!!n)},a.listen=function(e,t){s(this,l,e,t,f,c)},a.unlisten=function(e,t){o(this,l,e,t,f,c)},a}var u=Date.now();return a}),function(e){var t=!1;n("core/logger",[],function(){function n(e){this.log=function(n){t&&console.log("["+e+"] "+n)},this.error=function(n){if(t)throw new Error("["+e+"] "+n)}}return n.enabled=function(n){return n!==e&&(t=!!n),t},n})}(),function(e){function r(e,n,r){var i=t[e];return!i||!i.validate?n:i.validate(n)}var t={baseDir:{name:"{{baseDir}}",defaultValue:"./",validate:function(e){return e.replace(/\/?$/,"/")}}};n("core/config",[],function(){function n(i){function u(t){var n=o.length;while(n--)if(o[n].value(t)!==e)return o[n];return s}function a(r,i){if(r===e)return r;var s=r,o,a,f,l;for(var c in t)t.hasOwnProperty(c)&&(o=t[c],l=u(c),a=l instanceof n?l.value(c):l[c],f=a?a:o.defaultValue,s=s.replace?s.replace(o.name,f,"g"):s);return s}function f(t,n){if(t===e)return t;for(var r in t)t.hasOwnProperty(r)&&(typeof t[r]=="object"?t[r]=f(t[r],n):t[r]=a(t[r],n));return t}if(typeof i!="object")throw"Config Error: expected parsed config object";var s=i,o=[];this.value=function(t,i){var s=u(t);return s instanceof n?s.value(t,i):(i!==e&&(s[t]=r(t,i,s)),typeof s[t]=="object"?f(s[t],s):a(s[t],s))},this.merge=function(e){o.push(e)}}var i={parse:function(e){var t;try{return t=JSON.parse(e),new n(t)}catch(r){throw"Config.parse Error: unable to parse config string. Error was: "+r.message}}};return i})}(),n("util/dragndrop",[],function(){function d(){l=!1;if(o){for(var t=u.length-1;t>=0;--t)u[t].update();window.setTimeout(d,e)}}function v(t){f[0]=a[0],f[1]=a[1],a=[t.clientX,t.clientY];var n=[],r,i,l,c;if(o)for(l=u.length-1;l>=0;--l)n.push(u[l]);else{var h;o=!0,window.setTimeout(d,e);for(l=u.length-1;l>=0;--l)h=u[l],h.start(t),n.push(u[l])}for(l=n.length-1;l>=0;--l){i=n[l];for(c=s.length-1;c>=0;--c)r=s[c],!r.element.id||i.element.id===r.element.id||!r.drag(i.element.getBoundingClientRect())?r.forget(i):r.remember(i)}}function m(e){o=!1,window.removeEventListener("mousemove",v,!1);var t;for(var n=u.length-1;n>=0;--n)t=u[n],t.dragging&&t.stop()}function g(e){if(e.which!==1)return;e.preventDefault(),e.stopPropagation(),window.addEventListener("mousemove",v,!1),window.addEventListener("mouseup",m,!1)}function y(e){var t=getComputedStyle(e),n=t.getPropertyValue("padding-top"),r=t.getPropertyValue("padding-left"),i=t.getPropertyValue("padding-bottom"),s=t.getPropertyValue("padding-right");return{top:Number(n.substring(0,n.indexOf("px"))),left:Number(r.substring(0,r.indexOf("px"))),bottom:Number(i.substring(0,i.indexOf("px"))),right:Number(s.substring(0,s.indexOf("px")))}}function b(){return{top:0,left:0,right:window.innerWidth,bottom:window.innerHeight}}function w(e,t){var n=t.parentNode;while(n){if(n===e)return!0;n=n.parentNode}return!1}function E(e){var t=getComputedStyle(e).zIndex;if(isNaN(t)){t=0;var n=e.parentNode;while(n&&[window,document].indexOf(n)===-1){var r=getComputedStyle(n);if(r){var i=r.zIndex;isNaN(i)&&i>t&&(t=i)}n=n.parentNode}}}function S(){s=s.sort(function(e,t){var n=e.element,r=t.element,i=E(n),s=E(r);return w(n,r)?-1:w(r,n)?1:i-s})}function x(r,s){function d(s){function y(){var e=m-v,s=u+e,a=d-e;if(a<i)return;c&&c.scrollLeft>0&&o.left+e<h.left-n&&(c.scrollLeft-=t,s-=t,a+=t,v+=t),s<0&&(a+=s,s=0),r.style.left=s+"px",r.style.width=a+"px",p=r.getBoundingClientRect()}function b(e){window.removeEventListener("mousemove",w,!1),window.removeEventListener("mouseup",b,!1),clearInterval(l),l=-1,f()}function w(t){m=t.clientX,l===-1&&(l=setInterval(y,e),a())}s.stopPropagation();var o=r.getBoundingClientRect(),u=r.offsetLeft,d=r.offsetWidth,v=s.clientX,m,g;p=r.getBoundingClientRect(),g=s.clientX-p.left,h=c.getBoundingClientRect(),window.addEventListener("mousemove",w,!1),window.addEventListener("mouseup",b,!1)}function v(s){function g(){var e=v-d,s=u+e;if(s<i)return;c&&c.scrollLeft<c.scrollWidth-h.width&&v>h.right+n&&(c.scrollLeft+=t,d-=t),s+o>r.offsetParent.offsetWidth&&(s=r.offsetParent.offsetWidth-o),r.style.width=s+"px",p=r.getBoundingClientRect()}function y(e){window.removeEventListener("mousemove",b,!1),window.removeEventListener("mouseup",y,!1),clearInterval(l),l=-1,f()}function b(t){v=t.clientX,l===-1&&(l=setInterval(g,e),a())}s.stopPropagation();var o=r.offsetLeft,u=r.offsetWidth,d=s.clientX,v,m;p=r.getBoundingClientRect(),c&&(h=c.getBoundingClientRect()),m=s.clientX-p.left,window.addEventListener("mousemove",b,!1),window.addEventListener("mouseup",y,!1)}var o=document.createElement("div"),u=document.createElement("div"),a=s.start||function(){},f=s.stop||function(){},l=-1,c=s.scroll,h,p;return o.className="handle left-handle",u.className="handle right-handle",r.appendChild(o),r.appendChild(u),o.addEventListener("mousedown",d,!1),u.addEventListener("mousedown",v,!1),{destroy:function(){o.removeEventListener("mousedown",d,!1),u.removeEventListener("mousedown",v,!1),r.removeChild(o),r.removeChild(u)}}}function T(e,t){var n=t.image,r=t.start||function(){},i=t.stop||function(){},s=c.length;c[s]=e,e.setAttribute("draggable",!0),e.addEventListener("dragstart",function(t){h=e,t.dataTransfer.effectAllowed="all",t.dataTransfer.setData("text",s);if(n){var i=document.createElement("img");i.src=n.src,t.dataTransfer.setDragImage(i,i.width/2,i.height/2)}r()}),e.addEventListener("dragend",function(e){h=null,i()}),e.addEventListener("drop",function(e){})}function N(e,t){function p(t){t.preventDefault(),t.stopPropagation(),n&&e.classList.remove(n);var i=t.dataTransfer.getData("text"),s=c[i]||h;s&&r(s,[t.clientX,t.clientY])}function d(e){e.preventDefault(),e.stopPropagation(),e.dataTransfer.dropEffect="copy"}function v(t){n&&e.classList.add(n);var r=t.dataTransfer.getData("text"),s=c[r]||h;s&&i(s,[t.clientX,t.clientY])}function m(t){n&&e.classList.remove(n);var r=t.dataTransfer.getData("text"),i=c[r]||h;i&&o(i,[t.clientX,t.clientY])}t=t||{};var n=t.hoverClass,r=t.drop||function(){},i=t.over||function(){},o=t.out||function(){},u={},f={},l=0;return e.addEventListener("drop",p,!1),e.addEventListener("dragover",d,!1),e.addEventListener("dragenter",v,!1),e.addEventListener("dragleave",m,!1),u={element:e,remember:function(t){!f[t.element.id]&&!t.droppable&&(l++,e.classList.add(n),f[t.element.id]=t,t.droppable=u,i(t.element))},forget:function(t){f[t.element.id]&&t.droppable&&(--l===0&&e.classList.remove(n),t.droppable=null,o(t.element),delete f[t.element.id])},drop:function(t){f[t.element.id]&&(--l===0&&e.classList.remove(n),t.droppable=null,r(t.element,a),delete f[t.element.id])},drag:function(t){var n=e.getBoundingClientRect(),r=Math.max(t.left,n.left),i=Math.max(t.top,n.top),s=Math.min(t.right,n.right),o=Math.min(t.bottom,n.bottom);if(s<r||o<i)return!1;var u=[s-r,o-i];return u[0]*u[1]/2>t.width*t.height/4?!0:!1},destroy:function(){var t=s.indexOf(u);t>-1&&s.splice(t,1),e.removeEventListener("drop",p,!1),e.removeEventListener("dragover",d,!1),e.removeEventListener("dragenter",v,!1),e.removeEventListener("dragleave",m,!1)}},s.push(u),S(),u}function C(e,i){function M(){var t=a[0]-h[0],n=a[1]-h[1];if(!f||f.indexOf("x")>-1)e.style.left=t-w.left+"px";if(!f||f.indexOf("y")>-1)e.style.top=n-w.top+"px";v=e.getBoundingClientRect()}function _(){l||(v.right>m.right+n?(l=!0,o.scrollLeft+=S):v.left<m.left-n&&(l=!0,o.scrollLeft-=S)),L.updateRects()}function D(){var t=v.left,r=v.top,i=t+v.width,s=r+v.height;if(!f||f.indexOf("y")>-1)r<E.top?r=E.top:s>E.bottom&&(r=E.bottom-v.height),e.style.top=r-w.top-O.top+"px";if(!f||f.indexOf("x")>-1)i>m.right+n?(t=m.right+n-v.width,i=t+v.width):t<m.left-n&&(t=m.left-n,i=t+v.width),t<E.left?t=E.left:i>E.right&&(t=E.right-v.width),e.style.left=t-w.left-O.left+"px";v=e.getBoundingClientRect()}i=i||{};var s=i.containment,o=i.scroll,f=i.axis,c=i.revert,h,d=e,v,m,w,E,S=i.scrollAmount||t,x,T=i.start||function(){},N=i.stop||function(){return!1},C,k=null,L={destroy:function(){e.removeEventListener("mousedown",g,!1)}},A=!1,O=p;return s&&(O=y(s)),L.updateRects=function(){E=s?s.getBoundingClientRect():b(),w=e.offsetParent?e.offsetParent.getBoundingClientRect():E,m=o?o.getBoundingClientRect():E,v=e.getBoundingClientRect()},e.addEventListener("mousedown",g,!1),L.update=function(){M(),o&&_(),D()},L.start=function(t){A=!0,C=[e.offsetLeft,e.offsetTop],L.updateRects(),h=[t.clientX-v.left,t.clientY-v.top],T()},L.stop=function(){A=!1,N(),!k&&c?(e.style.left=C[0]+"px",e.style.top=C[1]+"px"):k&&k.drop(L)},Object.defineProperties(L,{selected:{enumerable:!0,get:function(){for(var e=u.length-1;e>=0;--e)if(u[e].element.id===d.id)return!0;return!1},set:function(t){if(t)x=getComputedStyle(e).getPropertyValue("z-index"),e.style.zIndex=r,u.push(L);else{e.style.zIndex=x;for(var n=u.length-1;n>=0;--n)if(u[n].element.id===d.id){u.splice(n,1);return}}}},dragging:{enumerable:!0,get:function(){return A}},element:{enumerable:!0,get:function(){return d}},droppable:{enumerable:!0,get:function(){return k},set:function(e){k=e}}}),L}function k(e,t){function p(t){var n=t.cloneNode(!1);return n.classList.add("placeholder"),e.replaceChild(n,t),n}function d(e){u.style.top=a-e+"px"}function v(t){if(!f)f=!0,c=p(u),e.appendChild(u),u.style.position="absolute",u.style.zIndex=r,d(0);else{var s=o-t.clientY;d(s);var a=u.getBoundingClientRect();for(var h=i.length-1;h>=0;--h){var v=i[h];if(v===u)continue;var m=v.getBoundingClientRect(),g=Math.max(a.left,m.left),y=Math.max(a.top,m.top),b=Math.min(a.right,m.right),w=Math.min(a.bottom,m.bottom);if(b<g||w<y)continue;var E=[b-g,w-y];if(E[0]*E[1]/2>a.width*a.height/4){l=v;var S=p(l);e.replaceChild(l,c),c=S;var x=[],T=e.childNodes;for(var N=0,C=T.length;N<C;++N){var k=T[N];k!==u&&(k!==c?x.push(k):x.push(u))}n(x)}}}}function m(e){if(e.which!==1)return;f=!1,u=this,a=u.offsetTop;var t=getComputedStyle(u);h=t.getPropertyValue("z-index"),o=e.clientY,window.addEventListener("mouseup",g,!1),window.addEventListener("mousemove",v,!1)}function g(t){u.style.zIndex=h,window.removeEventListener("mouseup",g,!1),window.removeEventListener("mousemove",v,!1),f=!1,c&&(u.style.zIndex="",u.style.position="",u.style.top="",e.replaceChild(u,c),c=null)}var n=t.change||function(){},i=[],s={},o=0,u,a,f,l,c,h;return s.addItem=function(e){i.push(e),e.addEventListener("mousedown",m,!1)},s.removeItem=function(e){i.splice(i.indexOf(e),1),e.removeEventListener("mousedown",m,!1)},s}var e=16,t=10,n=20,r=2147483647,i=15,s=[],o=!1,u=[],a=[0,0],f=[0,0],l=!1,c=[],h,p={top:0,left:0,bottom:0,right:0};return{draggable:C,droppable:N,helper:T,resizable:x,sortable:k}}),n("ui/position-tracker",[],function(){var e=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}();return function(t,n){function s(){var e=t.getBoundingClientRect();if(e.left!==r.left||e.top!==r.top)r={left:e.left,top:e.top,width:e.width,height:e.height},document.body.scrollTop<0&&(r.top+=document.body.scrollTop),n(r)}function o(){s(),i||e(o)}var r={},i=!1;return o(),window.addEventListener("scroll",s,!1),{destroy:function(){i=!0,window.removeEventListener("scroll",s,!1)}}}}),n("ui/page-element",["core/logger","core/eventmanager","util/dragndrop","ui/position-tracker"],function(e,t,n,r){var i=function(){};return function(e,s,o){function g(){a.classList.remove("blink"),!v&&!d&&(a.style.visibility="hidden"),d||(a.classList.remove("on"),m.blink=c)}var u=typeof e=="string"?document.getElementById(e):e,a=document.createElement("div"),f=s||{},l=o||{},c,h,p,d=!1,v=!1,m=this;t(m),h=r(u,function(e){a.style.left=e.left+"px",a.style.top=e.top+"px",a.style.width=e.width+"px",a.style.height=e.height+"px",m.dispatch("moved",e)}),this.highlight=function(e){e?(m.blink=i,d=!0,a.style.visibility="visible",a.classList.add("on"),a.classList.remove("blink")):(m.blink=c,d=!1,a.classList.remove("on"),v||(a.style.visibility="hidden"))},window.addEventListener("dragstart",function(e){a.style.visibility="visible",v=!0},!1),window.addEventListener("dragend",function(e){a.classList.contains("blink")||(a.style.visibility="hidden"),v=!1},!1),this.destroy=function(){h.destroy(),a.parentNode&&a.parentNode.removeChild(a),p&&p.destroy()},a.className="butter-highlight ",a.setAttribute("data-butter-exclude","true"),l.highlightClass&&(a.className+=l.highlightClass),a.style.visibility="hidden",this.blink=c=function(){m.blink=i,a.classList.add("on"),setTimeout(function(){a.classList.add("blink","true")},0),a.style.visibility="visible",setTimeout(g,1500)},u&&(document.body.appendChild(a),u.setAttribute("butter-clean","true"),p=n.droppable(a,{over:function(e){if(e.getAttribute("data-butter-draggable-type")!=="plugin")return;m.highlight(!0),f.over&&f.over()},out:function(e){if(e.getAttribute("data-butter-draggable-type")!=="plugin")return;m.highlight(!1),f.out&&f.out()},drop:function(e){if(e.getAttribute("data-butter-draggable-type")!=="plugin")return;m.highlight(!1),f.drop&&f.drop(e)}})),this.highlightElement=a,Object.defineProperties(this,{element:{enumerable:!0,get:function(){return u}}})}}),function(){n("core/target",["core/logger","core/eventmanager","ui/page-element"],function(e,t,n){var r=0,i=function(i){i=i||{};var s="Target"+r++,o=new e(s),u=i.name||s,a=i.element,f,l=this;t(l),typeof a=="string"&&(a=document.getElementById(a)),a?f=new n(a,{drop:function(e){l.dispatch("trackeventrequested",{element:e,target:l})}},{highlightClass:"butter-target-highlight"}):o.log("Warning: Target element is null."),this.destroy=function(){f&&f.destroy()},Object.defineProperties(this,{view:{enumerable:!0,get:function(){return f}},name:{enumerable:!0,get:function(){return u}},id:{enumerable:!0,get:function(){return s}},elementID:{enumerable:!0,get:function(){if(a)return a.id}},element:{enumerable:!0,get:function(){return a}},isDefault:{enumerable:!0,get:function(){return a&&a.hasAttribute("data-butter-default")?!0:!1}},json:{enumerable:!0,get:function(){var e="";return a&&a.id&&(e=a.id),{id:s,name:u,element:e}},set:function(e){e.name&&(u=e.name),e.element&&(a=document.getElementById(e.element))}}})};return i})}(),n("util/time",[],function(){function t(t){return Math.round(t*Math.pow(10,e))/Math.pow(10,e)}var e=3,n={roundTime:t};return Object.defineProperties(n,{timeAccuracy:{enumerable:!0,get:function(){return e},set:function(t){e=t}}}),n}),n("core/views/trackevent-view",["core/logger","core/eventmanager","util/dragndrop"],function(e,t,n){var r=0;return function(e,i,s){function b(e){p[0].style.visibility=e?"visible":"hidden",p[1].style.visibility=e?"visible":"hidden"}function w(){u.style.left=l*a+"px",u.style.width=(c-l)*a+"px"}function E(){u.style.top="0px";var e=u.getClientRects()[0];l=u.offsetLeft/a,c=l+e.width/a,g.update({start:l,end:c})}function S(e){v.selected=!0,u.setAttribute("selected",!0)}function x(e){v.selected=!1,u.removeAttribute("selected")}var o="TrackEventView"+r++,u=document.createElement("div"),a=1,f=i,l=s.start||0,c=s.end||l+1,h,p,d=document.createElement("div"),v,m,g=e,y=this;t(y),u.appendChild(d),this.setToolTip=function(e){u.title=e},this.update=function(e){e=e||{},u.style.top="0px",isNaN(e.start)||(l=e.start),isNaN(e.end)||(c=e.end),w()},Object.defineProperties(this,{trackEvent:{enumerable:!0,get:function(){return g}},element:{enumerable:!0,get:function(){return u}},start:{enumerable:!0,get:function(){return l},set:function(e){l=e,w()}},end:{enumerable:!0,get:function(){return c},set:function(e){c=e,w()}},type:{enumerable:!0,get:function(){return f},set:function(e){f=e,d.innerHTML=f,u.setAttribute("data-butter-trackevent-type",f)}},selected:{enumerable:!0,get:function(){return v.selected},set:function(e){e?S():x()}},zoom:{enumerable:!0,get:function(){return a},set:function(e){a=e,w()}},id:{enumerable:!0,configurable:!1,get:function(){return o}},parent:{enumerabled:!0,get:function(){return h},set:function(t){h=t,v&&(v.destroy(),v=null),m&&(b(!1),m.destroy(),m=null,p=null),h&&(h.element&&h.element.parentNode&&h.element.parentNode.parentNode&&(v=n.draggable(u,{containment:h.element.parentNode,scroll:h.element.parentNode.parentNode,start:function(){y.dispatch("trackeventdragstarted")},stop:function(){y.dispatch("trackeventdragstopped"),E()},revert:!0}),m=n.resizable(u,{containment:h.element.parentNode,scroll:h.element.parentNode.parentNode,stop:E}),u.setAttribute("data-butter-draggable-type","trackevent"),u.setAttribute("data-butter-trackevent-id",e.id),p||(p=u.querySelectorAll(".handle"),p&&p.length===2&&(u.addEventListener("mouseover",function(e){b(!0)},!1),u.addEventListener("mouseout",function(e){b(!1)},!1),b(!1)))),w())}}}),u.className="butter-track-event",y.type=f,u.id=o,y.update(s),u.addEventListener("mousedown",function(t){y.dispatch("trackeventmousedown",{originalEvent:t,trackEvent:e})},!0),u.addEventListener("mouseup",function(t){y.dispatch("trackeventmouseup",{originalEvent:t,trackEvent:e})},!1),u.addEventListener("mouseover",function(t){y.dispatch("trackeventmouseover",{originalEvent:t,trackEvent:e})},!1),u.addEventListener("mouseout",function(t){y.dispatch("trackeventmouseout",{originalEvent:t,trackEvent:e})},!1),u.addEventListener("dblclick",function(t){y.dispatch("trackeventdoubleclicked",{originalEvent:t,trackEvent:e})},!1)}}),n("core/views/track-view",["core/logger","core/eventmanager","util/dragndrop"],function(e,t,n){var r=0;return function(e){function d(){h=n.droppable(f,{hoverClass:"draggable-hover",drop:function(e,t){var n=e.getAttribute("data-butter-draggable-type"),r,i,u=f.getBoundingClientRect();n==="plugin"?(i=t[0]-u.left,r=i/u.width*l,o.dispatch("plugindropped",{start:r,track:s,type:e.getAttribute("data-butter-plugin-type")})):n==="trackevent"&&e.parentNode!==f&&(i=e.offsetLeft,r=i/u.width*l,o.dispatch("trackeventdropped",{start:r,track:s,trackEvent:e.getAttribute("data-butter-trackevent-id")}))}})}function v(){f.style.width=l*p+"px"}var i="TrackView"+r++,s=e,o=this,u=[],a=[],f=document.createElement("div"),l=1,c,h,p=1;t(o),f.className="butter-track",f.id=i,Object.defineProperties(this,{element:{enumerable:!0,configurable:!1,get:function(){return f}},zoom:{enumerable:!0,get:function(){return p},set:function(e){p=e,v();for(var t=0,n=u.length;t<n;++t)u[t].zoom=p}},duration:{enumerable:!0,get:function(){return l},set:function(e){l=e,v();for(var t=0,n=u.length;t<n;++t)u[t].update()}},parent:{enumerable:!0,get:function(){return c},set:function(e){c=e,h&&(h.destroy(),h=null),c&&d();for(var t=0,n=u.length;t<n;++t)u[t].parent=o}}}),this.addTrackEvent=function(e){var t=e.view.element;f.appendChild(t),u.push(e.view),a.push(e.view.element),e.view.zoom=p,e.view.parent=o,o.chain(e,["trackeventmousedown","trackeventmouseover","trackeventmouseout"])},this.removeTrackEvent=function(e){var t=e.view.element;f.removeChild(t),u.splice(u.indexOf(e.view),1),a.splice(u.indexOf(e.view.element),1),e.view.parent=null,o.unchain(e,["trackeventmousedown","trackeventmouseover","trackeventmouseout"])}}}),n("util/uri",[],function(){function e(t){var n=e.options,r=n.parser[n.strictMode?"strict":"loose"].exec(t),i={},s=14;while(s--)i[n.key[s]]=r[s]||"";return i[n.q.name]={},i[n.key[12]].replace(n.q.parser,function(e,t,r){t&&(i[n.q.name][t]=r)}),i}function r(e){var t="";return t+=e.protocol?e.protocol+"://":"",t+=e.authority||"",t+=e.path||"",t+=e.query?"?"+e.query:"",t+=e.anchor?"#"+e.anchor:"",t}e.options={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}};var t="butteruid",n=Date.now(),i={set seed(e){n=e|0},get seed(){return n},parse:function(t){var n=e(t);return n.toString=function(){return r(this)},n},makeUnique:function(e){var r,i,s,o="",u=0;typeof e=="string"&&(e=this.parse(e)),s=e.queryKey,s[t]=n++;for(r in s)s.hasOwnProperty(r)&&(i=s[r],o+=u>0?"&":"",o+=r,o+=!i&&i!==0?"":"="+i,u++);return e.query=o,e}};return i}),n("core/popcorn-wrapper",["core/logger","core/eventmanager","util/uri"],function(e,t,n){var r=/(?:http:\/\/www\.|http:\/\/|www\.|\.|^)(youtu|vimeo|soundcloud|baseplayer)/,i=100,s=1e4,o=1e4;return function(t,u){function E(){for(var e in l)l.hasOwnProperty(e)&&m.on(e,l[e])}function S(e){var t=r.exec(e);return t?(g=t[1],g==="youtu"&&(g="youtube")):g="object",g}function x(e){var t=document.getElementById(e);if(g!=="object"&&t&&["VIDEO","AUDIO"].indexOf(t.nodeName)!==-1){var n=t.parentNode,r=document.createElement("div"),i;r.id=t.id,i=t.attributes;if(i)for(var s=i.length-1;s>=0;s--){var o=i[s].nodeName;r.setAttribute(o,t.getAttribute(o))}t.className&&(r.className=t.className),n.replaceChild(r,t),r.setAttribute("data-butter","media")}}function N(e){var t=new Function("",e),n=t();if(!n){var r=document.createElement("script");r.innerHTML=e,document.head.appendChild(r),n=window.Popcorn.instances[window.Popcorn.instances.length-1]}m=n}function C(e,t,n,r){function a(){if(s)return;e()?(u=!0,t()):setTimeout(a,i)}var s=!1,u=!1;setTimeout(function(){u||(s=!0,n())},o),a()}function k(e,t){C(function(){return m&&m.media.readyState>=1&&m.duration()>0},e,t,o)}function L(e,t){g!=="object"?(d(g),C(function(){return!!window.Popcorn[g]},e,t,s)):e()}var a=t,f=new e(a+"::PopcornWrapper"),l=u.popcornEvents||{},c=u.prepare||function(){},h=u.constructing||function(){},p=u.fail||function(){},d=u.playerTypeRequired||function(){},v=u.timeout||function(){},m,g,y={},b=!1,w=this;this.unbind=function(){try{m.destroy(),m=undefined}catch(e){f.log("WARNING: Popcorn did NOT get destroyed properly: \n"+e.message+"\n"+e.stack)}},this.interruptLoad=function(){b=!0},this.updateEvent=function(e){var t=e.popcornOptions,n=e.id,r=y[n],i=null;m&&(r&&m.getTrackEvent(r)&&m.removeTrackEvent(r),m[e.type]&&(m[e.type](t),y[n]=m.getLastTrackEventId(),i=m.getTrackEvent(y[n]),e.popcornTrackEvent=i,e.view&&(i.toString?e.view.setToolTip(i.toString()):e.view.setToolTip(JSON.stringify(t)))))},this.destroyEvent=function(e){var t=e.id,n=y[t];m&&(n&&m.getTrackEvent(n)&&m.removeTrackEvent(n),delete y[t])},this.prepare=function(e,t,n,r,i){function o(e){b=!0,v(e)}function u(e){b=!0,f.log(e),p(e)}var s,a=e;if(typeof e!="string"){if(!e.length)throw"URL is invalid: empty array or not a string.";a=e[0]}else e.indexOf(",")>-1&&(s=e.split(","),a=s[0],e=s);S(a);if(!t){f.log("Warning: tried to prepare media with null target.");return}if(!m)try{L(function(){x(t),N(T(n,e,t,null,r,i)),E(),h&&h(),k(c,o)},o)}catch(l){u(l)}};var T=this.generatePopcornString=function(e,t,r,i,s,o,u){s=s||{},o=o||{};var a="",l,c,h,p;t=typeof t=="string"?[t]:t;for(h=0;h<t.length;h++)t[h]=n.makeUnique(t[h]).toString();t=JSON.stringify(t),e?e=", "+JSON.stringify(e):e=", {}",typeof r!="string"&&(r&&r.id?r=r.id:f.log("WARNING: Unexpected non-string Popcorn target: "+r));if(!g)throw new Error("Media type not generated yet. Please specify a url for media objects before generating a popcorn string.");o.init&&(a+=o.init+"\n"),s.init&&(a+=s.init+"();\n"),g==="baseplayer"?a+="Popcorn.player( 'baseplayer' );\nvar popcorn = Popcorn.baseplayer( '#"+r+"' "+e+" );\n":a+="var popcorn = Popcorn.smart( '#"+r+"', "+t+e+" );\n",o.beforeEvents&&(a+=o.beforeEvents+"\n"),s.beforeEvents&&(a+=s.beforeEvents+"( popcorn );\n");if(m&&u)for(h=u.length-1;h>=0;h--){e=u[h].popcornOptions,c={};for(p in e)e.hasOwnProperty(p)&&e[p]!==undefined&&(c[p]=e[p]);try{l=JSON.stringify(c,null,4)}catch(d){l=!1,f.log("WARNING: Unable to export event options: \n"+d.message)}l&&(a+="popcorn."+u[h].type+"("+l+");\n")}return o.afterEvents&&(a+=o.afterEvents+"\n"),s.afterEvents&&(a+=s.afterEvents+"( popcorn );\n"),a+="popcorn.controls( true );\n",i=i||"inline",i==="event"?(a="\ndocument.addEventListener('DOMContentLoaded',function(e){\n"+a,a+="\n},false);"):a+="\nreturn popcorn;",a};this.play=function(){m.play()},this.pause=function(){m.pause()},this.clear=function(e){typeof e=="string"&&(e=document.getElementById(e));if(!e){f.log("Warning: tried to clear media with null target.");return}m&&w.unbind();while(e.firstChild)e.removeChild(e.firstChild);["AUDIO","VIDEO"].indexOf(e.nodeName)>-1&&(e.currentSrc="",e.src="",e.removeAttribute("src"))},Object.defineProperties(this,{volume:{enumerable:!0,set:function(e){m&&m.volume(e)},get:function(){return m?m.volume():!1}},muted:{enumerable:!0,set:function(e){m&&(e?m.mute():m.unmute())},get:function(){return m?m.muted():!1}},currentTime:{enumerable:!0,set:function(e){m&&m.currentTime(e)},get:function(){return m?m.currentTime():0}},duration:{enumerable:!0,get:function(){return m?m.duration():0}},popcorn:{enumerable:!0,get:function(){return m}},paused:{enumerable:!0,get:function(){return m?m.paused():!0},set:function(e){m&&(e?m.pause():m.play())}}})}}),n("ui/logo-spinner",[],function(){return function(e){var t=document.createElement("div"),n=document.createElement("div");return t.className="butter-logo-spin-outer",n.className="butter-logo-spin-inner",t.appendChild(n),e&&e.appendChild(t),{element:t,start:function(){t.classList.remove("fade-out"),n.classList.add("active")},stop:function(e){t.classList.add("fade-out"),setTimeout(function(){n.classList.remove("active"),e&&e()},500)}}}}),n("ui/widget/textbox",[],function(){function e(t){var n=t.target;n.select(),n.removeEventListener("focus",e,!1)}function t(e){e.preventDefault();var n=e.target;n.removeEventListener("mouseup",t,!1)}function n(n){n.addEventListener("focus",e,!1),n.addEventListener("mouseup",t,!1)}return function(e){if(!e||e.type!=="text")throw"Textbox: Expected an input element of type text";return e.addEventListener("blur",function(e){n(e.target)},!1),n(e),e}}),n("core/page",["core/logger","core/eventmanager"],function(e,t){return function(e,n){var r="{popcorn-js}/players/{type}/popcorn.{type}.js",i;t(this),this.scrape=function(){var e=document.body,t=e.querySelectorAll("*[data-butter='target']"),n=e.querySelectorAll("*[data-butter='media']");return{media:n,target:t}},this.prepare=function(t){e.load([{type:"js",url:"{popcorn-js}/popcorn.js",check:function(){return!!window.Popcorn}},{type:"js",url:"{popcorn-js}/modules/player/popcorn.player.js",check:function(){return!!window.Popcorn&&!!window.Popcorn.player}}],t,null,!0)},this.addPlayerType=function(t,n){e.load({type:"js",url:r.replace(/\{type\}/g,t),check:function(){return!!Popcorn[t]}},n)},this.getHTML=function(e){var t,n,r,s,o,u,a,f,l,c,h;t=document.createElement("html"),i?r=i.body.cloneNode(!0):r=document.getElementsByTagName("body")[0].cloneNode(!0),n=document.getElementsByTagName("head")[0].cloneNode(!0),a=Array.prototype.slice.call(n.querySelectorAll("*[data-butter-exclude]")),a=a.concat(Array.prototype.slice.call(n.querySelectorAll("*[data-requiremodule]")));for(s=0,o=a.length;s<o;++s)f=a[s],f.parentNode.removeChild(f);h=r.querySelectorAll("*[data-butter='media']");for(s=0,o=h.length;s<o;++s)f=h[s],l=document.getElementById(f.id).cloneNode(!0),["VIDEO","AUDIO"].indexOf(l.nodeName)===-1&&(l.innerHTML=""),f.parentNode.replaceChild(l,f),l.removeAttribute("data-butter-source");u=r.querySelectorAll('*[butter-clean="true"]');for(s=0,o=u.length;s<o;++s)f=u[s],f.removeAttribute("butter-clean"),f.removeAttribute("data-butter"),f.removeAttribute("data-butter-default"),f.classList?f.classList.remove("ui-droppable"):f.className=f.className.replace(/ui-droppable/g,"");a=r.querySelectorAll("*[data-butter-exclude]");for(s=0,o=a.length;s<o;++s)f=a[s],f.parentNode.removeChild(f);c=document.createElement("base"),c.href=window.location.href.substring(0,window.location.href.lastIndexOf("/")+1),n.insertBefore(c,n.firstChild),t.appendChild(n),t.appendChild(r);if(e)for(s=0;s<e.length;++s){var p=document.createElement("script");p.type="text/javascript",p.innerHTML="(function(){\n"+e[s]+"\n}());",r.appendChild(p)}return this.dispatch("getHTML",t),"<html>"+t.innerHTML+"</html>"},this.snapshotHTML=function(){i={head:document.getElementsByTagName("head")[0].cloneNode(!0),body:document.getElementsByTagName("body")[0].cloneNode(!0)}},this.eraseSnapshot=function(){i=null}}}),n("core/comm",["./eventmanager"],function(e){var t=1,n=function(n,r){function f(){u||(a||i.dispatch("error",{type:"connectionclosed"}),l())}function l(){a=!1,i.send("ping"),setTimeout(f,1e3)}var i=this,s,o=t++,u=!1,a=!1;e(i),n.addEventListener("message",function(e){e.source===n&&typeof e.data=="object"&&e.data.context&&(e.data.type==="pong"?a=!0:i.dispatch(e.data.type,e.data.data))},!1),i.listen("ready",function(e){clearInterval(s),r(),l()}),s=setInterval(function(){i.send("ready","ready")},100),this.send=function(e,t){n.postMessage({type:e,context:o,data:t},"*")},this.destroy=function(){u=!0,clearInterval(s)}};return n}),n("dialog/modal",[],function(){var e;return function(t){e||(e=document.createElement("div"),e.id="butter-modal-container",e.setAttribute("data-butter-exclude",!0),document.body.appendChild(e));var n=document.createElement("div");n.className="layer",t&&typeof t=="string"&&(n.className+=t),e.appendChild(n),setTimeout(function(){n.className+=" fade-in"},10),this.destroy=function(){e.removeChild(n)},Object.defineProperties(this,{element:{enumerable:!0,get:function(){return n}}})}}),n("dialog/iframe-dialog",["core/comm","core/eventmanager","dialog/modal"],function(e,t,n){return function(
r){function d(e){i.dispatch(e.type,e.data)}function v(e){i.dispatch(e.type,e.data),i.close()}r=r||{};if(!r.url)throw new Error("IFRAME dialog requires a url.");var i=this,s=r.url,o=r.parent,u=r.classes||"fade-in",a=!1,f,l=[],c,h,p=r.events||{};t(i),this.modal=r.modal,this.close=function(){i.send("close"),setTimeout(function(){o.removeChild(f),h&&(h.destroy(),h=undefined),c.unlisten("submit",d),c.unlisten("cancel",v),c.unlisten("close",i.close),c.destroy(),a=!1,window.removeEventListener("beforeunload",i.close,!1);for(var e in p)e!=="close"&&i.unlisten(e,p[e]);i.dispatch("close"),i.unlisten("close",p.close)},0)},this.open=function(t){if(a)return;i.modal&&(h=new n(i.modal));for(var r in t)t.hasOwnProperty(r)&&(p[r]=t[r]);var m=h?h.element:document.body;o=o||m,f=document.createElement("iframe"),f.src=s,f.addEventListener("load",function(t){c=new e(f.contentWindow,function(){c.listen("submit",d),c.listen("cancel",v),c.listen("close",i.close),window.addEventListener("beforeunload",i.close,!1);for(var e in p)p.hasOwnProperty(e)&&i.listen(e,p[e]);while(l.length>0){var t=l.pop();i.send(t.type,t.data)}a=!0,setTimeout(function(){i.focus()},0),i.dispatch("open")})},!1),o.appendChild(f),setTimeout(function(){f.className+=" "+u.trim()},10)},this.send=function(e,t){c?c.send(e,t):l.push({type:e,data:t})},this.focus=function(){f.contentWindow.focus()},Object.defineProperties(this,{iframe:{enumerable:!0,get:function(){return f}},closed:{enumerable:!0,get:function(){return!a}}})}}),n("dialog/window-dialog",["core/comm","core/eventmanager","dialog/modal"],function(e,t,n){var r=640,i=479,s=300;return function(o){function g(e){u.dispatch(e.type,e.data)}function y(e){u.dispatch(e.type,e.data),u.close()}function b(e){e.data.type==="connectionclosed"&&u.close(),u.dispatch("error",e.data)}function w(){l&&l.closed===!0&&u.close()}o=o||{};if(!o.url)throw new Error("Window dialog requires a url.");var u=this,a=o.url,f,l,c,h,p=[],d=!1,v=["width="+(o.width||r),"height="+(o.height||i),"toolbar=no","menubar=no","titlebar=yes","location=no","resizable=yes"],m=o.events||{};t(u),u.modal=o.modal,this.close=function(){u.send("close"),setTimeout(function(){c&&(c.destroy(),c=undefined),f.unlisten("submit",g),f.unlisten("cancel",y),f.unlisten("close",u.close),f.destroy(),l.close&&l.close(),clearInterval(h),window.removeEventListener("beforeunload",u.close,!1),f=l=undefined,d=!1;for(var e in m)m.hasOwnProperty(e)&&u.unlisten(e,m[e]);u.dispatch("close")},0)},this.open=function(t){u.modal&&(c=new n(u.modal));for(var r in t)t.hasOwnProperty(r)&&(m[r]=t[r]);l=window.open(a,"dialog-window:"+a,v.join(",")),window.addEventListener("beforeunload",u.close,!1),f=new e(l,function(){f.listen("error",b),f.listen("submit",g),f.listen("cancel",y),f.listen("close",u.close);for(var e in m)m.hasOwnProperty(e)&&u.listen(e,m[e]);h=setInterval(w,s);while(p.length>0){var t=p.pop();u.send(t.type,t.data)}d=!0,u.dispatch("open")})},this.focus=function(){l.focus()},this.send=function(e,t){f?f.send(e,t):p.push({type:e,data:t})},Object.defineProperties(this,{closed:{enumerable:!0,get:function(){return!d}}})}}),n("editor/editor",["core/eventmanager","dialog/iframe-dialog","dialog/window-dialog","util/time"],function(e,t,n,r){function o(r,o,u,a,f,l){function b(){if(m===r.currentMedia.target)r.currentMedia.view.blink();else{var e=r.getTargetByType("elementID",m);e&&e.view.blink()}}function w(e){var t=g.popcornOptions;t.target!==m&&(m=t.target,b()),d.send("trackeventupdated",g.popcornOptions)}function E(e){d.send("trackeventupdatefailed",e.data)}function S(){d=null,g.unlisten("trackeventupdated",w),g.unlisten("trackeventupdatefailed",E),y.dispatch("close")}l=l||{};var c=a||s,h=u,p=i.slice(),d,v={type:c,modal:"behind-timeline",url:o,parent:f},m,g,y=this;e(y),p[0]=l.width||p[0],p[1]=l.height||p[1],this.open=function(e){d||(c==="window"?d=new n(v):d=new t(v));if(!d.closed&&d.focus){d.focus();return}g=e,d.open({open:function(t){var n=[],i={name:r.currentMedia.name,target:r.currentMedia.target};for(var s=0,o=r.targets.length;s<o;s++)n.push(r.targets[s].element.id);var u=e.popcornOptions;d.send("trackeventdata",{manifest:Popcorn.manifest[e.type],popcornOptions:u,targets:n,media:i}),m=u.target,b(),e.listen("trackeventupdated",w),e.listen("trackeventupdatefailed",E),y.dispatch("open")},submit:function(t){var n=t.data.eventData,r=t.data.alsoClose;n&&(e.update(n),r&&d.close())},close:function(e){S()}})},this.close=function(){g&&d&&d.close()},Object.defineProperties(y,{isOpen:{enumerable:!0,get:function(){return!!d}},type:{enumerable:!0,get:function(){return h}},frame:{enumerable:!0,get:function(){return c}},size:{enumerable:!0,get:function(){return{width:p[0],height:p[1]}},set:function(e){e=e||{},p[0]=e.width||p[0],p[1]=e.height||p[1]}}})}var i=[400,400],s="iframe";return o}),n("timeline/track-container",["core/logger","util/dragndrop"],function(e,t){return function(e,n){function c(){u.style.width=r.duration*i+"px"}function h(e){var t=e.data.view;u.appendChild(t.element),t.duration=r.duration,t.zoom=i,t.parent=s,f&&f.update()}var r=n,i=1,s=this,o=document.createElement("div"),u=document.createElement("div"),a,f,l;o.appendChild(u),o.className="tracks-container-wrapper",u.className="tracks-container",u.addEventListener("mousedown",function(e){s.deselectOthers()},!1),l=t.droppable(o,{drop:function(t,n){if(t.getAttribute("data-butter-draggable-type")==="plugin"){var r=e.currentMedia.addTrack(),i=r.view.element.getBoundingClientRect(),s=n[0]-i.left,o=s/i.width*r.view.duration;r.view.dispatch("plugindropped",{start:o,track:r,type:t.getAttribute("data-butter-plugin-type")})}}}),this.setScrollbars=function(e,t){a=e,f=t,f.update()},this.orderTracks=function(e){for(var t=0,n=e.length;t<n;++t){var r=e[t].view.element;r!==u.childNodes[t]&&(e[t].order=t,u.insertBefore(r,u.childNodes[t+1]))}},this.deselectOthers=function(){for(var t=0;t<e.selectedEvents.length;t++)e.selectedEvents[t].selected=!1;return e.selectedEvents=[],s},r.listen("mediaready",function(){c();var e=r.tracks;for(var t=0,n=e.length;t<n;++t){var o=e[t].view;u.appendChild(o.element),o.duration=r.duration,o.zoom=i,o.parent=s}}),e.listen("mediaremoved",function(e){e.data===r&&l&&l.destroy()});var p=r.tracks;for(var d=0;d<p.length;++d)h({data:p[d]});r.listen("trackadded",h),r.listen("trackremoved",function(e){var t=e.data.view;u.removeChild(t.element),f&&f.update()}),s.update=function(){c()},s.snapTo=function(e){var t=e/r.duration,n=u.clientWidth*t,i=u.clientWidth-o.clientWidth;if(n<o.scrollLeft||n>o.scrollLeft+o.clientWidth){if(n>i){o.scrollLeft=i;return}o.scrollLeft=n}},Object.defineProperties(this,{zoom:{enumerable:!0,get:function(){return i},set:function(e){i=e,c();var t=r.tracks;for(var n=0,s=t.length;n<s;++n)t[n].view.zoom=i}},element:{enumerable:!0,get:function(){return o}},container:{enumerable:!0,get:function(){return u}}})}}),n("timeline/scrollbars",["core/eventmanager"],function(e){function n(n,r){function d(){l=o.getBoundingClientRect().height,f=i.getBoundingClientRect().height,c=f-(u.scrollHeight-l)/t,c=Math.max(20,Math.min(f,c)),s.style.height=c+"px",y()}function v(){window.removeEventListener("mouseup",v,!1),window.removeEventListener("mousemove",m,!1),s.addEventListener("mousedown",g,!1)}function m(e){var t=e.pageY-h;t=Math.max(0,Math.min(t,f-c)),s.style.top=t+"px";var n=s.offsetTop/(f-c);o.scrollTop=(u.scrollHeight-l)*n,p.dispatch("scroll",o.scrollTop)}function g(e){if(e.button===0){var t=s.offsetTop;h=e.pageY-t,window.addEventListener("mouseup",v,!1),window.addEventListener("mousemove",m,!1),s.removeEventListener("mousedown",g,!1)}}function y(){u.scrollHeight-f>0?s.style.top=(f-c)*(o.scrollTop/(u.scrollHeight-l))+"px":s.style.top="0px"}var i=document.createElement("div"),s=document.createElement("div"),o=n.element,u=n.container,a=r||o,f,l,c,h=0,p=this;e(p),i.className="scroll-bar scroll-bar-v",s.className="scroll-handle",i.appendChild(s),this.update=function(){d()},o.addEventListener("scroll",function(e){y()},!1),a.addEventListener("mousewheel",function(e){e.wheelDeltaY&&(o.scrollTop-=e.wheelDeltaY,y(),e.preventDefault())},!1),a.addEventListener("DOMMouseScroll",function(e){e.axis===e.VERTICAL_AXIS&&!e.shiftKey&&(o.scrollTop+=e.detail*2,y(),e.preventDefault())},!1),i.addEventListener("click",function(e){if(e.srcElement===s||e.button>0)return;var t=e.pageY,n=s.getBoundingClientRect(),r=i.getBoundingClientRect(),a;t>n.bottom?s.style.top=t-r.top-c+"px":t<n.top&&(s.style.top=t-r.top+"px"),a=s.offsetTop/(f-c),o.scrollTop=(u.scrollHeight-f)*a},!1),window.addEventListener("resize",d,!1),s.addEventListener("mousedown",g,!1),d(),Object.defineProperties(this,{element:{enumerable:!0,get:function(){return i}}})}function r(t,n){function v(){f=s.getBoundingClientRect().width,l=o.getBoundingClientRect().width,a=r.getBoundingClientRect().width,c=o.scrollWidth,h=a-(c-f),h=Math.max(20,Math.min(a,h)),i.style.width=h+"px",b()}function m(){window.removeEventListener("mouseup",m,!1),window.removeEventListener("mousemove",g,!1),i.addEventListener("mousedown",y,!1)}function g(e){var t=e.pageX-p;t=Math.max(0,Math.min(t,a-h)),i.style.left=t+"px";var n=i.offsetLeft/(a-h);s.scrollLeft=(c-a)*n,d.dispatch("scroll",s.scrollLeft)}function y(e){if(e.button===0){var t=i.offsetLeft;p=e.pageX-t,window.addEventListener("mouseup",m,!1),window.addEventListener("mousemove",g,!1),i.removeEventListener("mousedown",y,!1)}}function b(){c-a>0?i.style.left=(a-h)*(s.scrollLeft/(c-a))+"px":i.style.left="0px"}var r=document.createElement("div"),i=document.createElement("div"),s=t.element,o=t.container,u=n||o,a,f,l,c,h,p=0,d=this;e(d),r.className="scroll-bar scroll-bar-h",i.className="scroll-handle",r.appendChild(i),s.addEventListener("scroll",function(e){b()},!1),u.addEventListener("mousewheel",function(e){e.wheelDeltaX&&(s.scrollLeft-=e.wheelDeltaX,b(),e.preventDefault())},!1),u.addEventListener("DOMMouseScroll",function(e){if(e.axis===e.HORIZONTAL_AXIS||e.axis===e.VERTICAL_AXIS&&e.shiftKey)s.scrollLeft+=e.detail*2,b(),e.preventDefault()},!1),r.addEventListener("click",function(e){if(e.srcElement===i||e.button>0)return;var t=e.pageX,n=i.getBoundingClientRect(),o=r.getBoundingClientRect(),u;t>n.right?i.style.left=t-o.left-h+"px":t<n.left&&(i.style.left=t-o.left+"px"),u=i.offsetLeft/(a-h),s.scrollLeft=(c-a)*u},!1),window.addEventListener("resize",v,!1),i.addEventListener("mousedown",y,!1),this.update=function(){v()},v(),Object.defineProperties(this,{element:{enumerable:!0,get:function(){return r}}})}var t=3;return{Vertical:n,Horizontal:r}}),n("timeline/scrubber",[],function(){var e=50,t=16,n=20,r=3;return function(i,s,o,u,a){function A(){var e=m.duration,t=m.currentTime,n=p.element,r=n.scrollLeft;if(N!==t||C!==r||k!==b){var i=t/e*d,s=i-r;i<r||i-L>f.clientWidth+r?l.style.display="none":(l.style.left=s+"px",l.style.display="block"),i<r?h.style.display="none":(i>S+r?h.style.width=S-2+"px":h.style.width=s+"px",h.style.display="block")}N=t,C=r,k=b}function O(e){x&&(m.play(),T=!1),clearInterval(w),w=-1,window.removeEventListener("mouseup",O,!1),window.removeEventListener("mousemove",D,!1)}function M(e){e==="right"?w=setInterval(function(){y<E.right-r?(clearInterval(w),w=-1):(y+=n,p.element.scrollLeft+=n,_(),A())},t):w=setInterval(function(){y>E.left+r?(clearInterval(w),w=-1):(y-=n,p.element.scrollLeft-=n,_(),A())},t)}function _(){var e=y-g;e=Math.max(0,Math.min(e,S)),m.currentTime=(e+p.element.scrollLeft)/d*m.duration}function D(e){y=e.pageX,w===-1&&(y>E.right-r?M("right"):y<E.left+r&&M("left")),_(),A()}function P(e){g=e.pageX-l.offsetLeft,x&&(m.pause(),T=!0),l.removeEventListener("mousedown",P,!1),window.addEventListener("mousemove",D,!1),window.addEventListener("mouseup",O,!1)}function B(){A()}var f=document.createElement("div"),l=document.createElement("div"),c=document.createElement("div"),h=document.createElement("div"),p=u,d,v=s,m=o,g,y,b=1,w=-1,E,S,x=!1,T=!1,N=-1,C=p.element.scrollLeft,k=-1,L=0;f.className="time-bar-scrubber-container",l.className="time-bar-scrubber-node",c.className="time-bar-scrubber-line",l.title=c.title="Displays the media's current time. Drag to seek through the media.",h.className="fill-bar",l.appendChild(c),f.appendChild(h),f.appendChild(l),v.appendChild(f),i.ui.registerStateToggleFunctions("timeline",{transitionIn:function(){c.removeAttribute("data-butter-shortened")},transitionOut:function(){c.setAttribute("data-butter-shortened",!0)}}),a.listen("scroll",A);var H=this.onMouseDown=function(e){var t=e.pageX-f.getBoundingClientRect().left;m.currentTime=(t+p.element.scrollLeft)/d*m.duration,A(),P(e)};l.addEventListener("mousedown",P,!1),f.addEventListener("mousedown",H,!1),this.update=function(e,t){b=t||b,S=e,d=p.container.getBoundingClientRect().width,f.style.width=S+"px",E=f.getBoundingClientRect(),L=c.clientWidth,A()},m.listen("mediaplaying",function(e){x=!0}),m.listen("mediapause",function(e){T||(x=!1)});var j=setInterval(B,e);this.destroy=function(){clearInterval(j)}}}),n("timeline/zoombar",[],function(){var e=6;return function(t){function f(){window.removeEventListener("mouseup",f,!1),window.removeEventListener("mousemove",l,!1),r.addEventListener("mousedown",c,!1),t(r.offsetLeft/(i.width-r.clientWidth))}function l(e){var n=e.pageX-s;n=Math.max(0,Math.min(n,u-o)),r.style.left=n+"px",t(r.offsetLeft/(i.width-r.clientWidth))}function c(e){if(e.button===0){var t=r.offsetLeft;s=e.pageX-t,window.addEventListener("mouseup",f,!1),window.addEventListener("mousemove",l,!1),r.removeEventListener("mousedown",c,!1)}}var n=document.createElement("div"),r=document.createElement("div"),i,s,o,u,a=this;n.className="zoom-bar scroll-bar",r.className="scroll-handle",r.title="Change the zoom level of the timeline",n.appendChild(r),r.addEventListener("mousedown",c,!1),this.update=function(){i=n.getBoundingClientRect(),o=i.width/e,r.style.width=o+"px",u=i.width},this.zoom=function(e){a.update(),r.style.left=(i.width-r.clientWidth)*e+"px",t(r.offsetLeft/(i.width-r.clientWidth))},n.addEventListener("click",function(e){if(e.srcElement===r)return;var t=e.pageX,i=r.getBoundingClientRect(),s=n.getBoundingClientRect();t>i.right?r.style.left=t-s.left-o+"px":r.style.left=t-s.left+"px",l(e)},!1),n.addEventListener("resize",function(e){a.update()},!1),Object.defineProperties(this,{element:{enumerable:!0,get:function(){return n}}})}}),n("timeline/status",[],function(){function e(e,t,n){function u(){o?s.removeAttribute("state"):s.setAttribute("state",!0)}function a(e){i.removeAttribute("mouse-state"),window.removeEventListener("mouseup",a,!1)}var r=document.createElement("div"),i=document.createElement("div"),s=document.createElement("div"),o=!0;r.className=e,i.className="status-button",i.title=n||"",s.className="status-button-icon",r.appendChild(i),i.appendChild(s),i.addEventListener("mousedown",function(e){i.setAttribute("mouse-state","depressed"),window.addEventListener("mouseup",a,!1)},!1),i.addEventListener("click",t,!1),Object.defineProperties(this,{element:{enumerable:!0,get:function(){return r}},state:{enumerable:!0,get:function(){return o},set:function(e){o=e,u()}}})}function t(e){function s(e,t){if(typeof e=="string"||!isNaN(e)){if(t)try{r.currentTime=Popcorn.util.toSeconds(e)}catch(s){e=r.currentTime}var o=new Date(1970,0,1),u;o.setSeconds(e),u=o.toTimeString().substr(0,8),u>86399&&(u=Math.floor((o-Date.parse("1/1/70"))/36e5)+u.substr(2)),n.value=u}else n.value=i}var t=document.createElement("div"),n=document.createElement("input"),r=e,i=0;t.className="time-container",t.appendChild(n),n.type="text",r.listen("mediatimeupdate",function(e){s(r.currentTime,!1)}),n.addEventListener("focus",function(e){i=n.value},!1),n.addEventListener("blur",function(e){n.value!==i&&s(n.value,!0)},!1),n.addEventListener("keydown",function(e){e.which===13?n.blur():e.which===27&&(n.value=i,n.blur())},!1),s(0,!1),Object.defineProperties(this,{element:{enumerable:!0,get:function(){return t}}})}return function(n){var r=n,i=document.createElement("div"),s,o,u,a=this;i.className="status-container",u=new t(r),s=new e("mute-button-container",function(e){r.muted=!r.muted},"Toggle volume on/off"),o=new e("play-button-container",function(e){r.ended?r.paused=!1:r.paused=!r.paused},"Play/Pause media"),r.listen("mediamuted",function(e){s.state=!1}),r.listen("mediaunmuted",function(e){s.state=!0}),r.listen("mediavolumechange",function(e){s.state=!r.muted}),r.listen("mediaended",function(e){o.state=!0}),r.listen("mediaplaying",function(e){o.state=!1}),r.listen("mediapause",function(e){o.state=!0}),i.appendChild(u.element),i.appendChild(o.element),a.update=function(){},a.destroy=function(){},Object.defineProperties(this,{statusElement:{enumerable:!0,get:function(){return i}},muteElement:{enumerable:!0,get:function(){return s.element}}})}}),n("timeline/trackhandles",["dialog/iframe-dialog","util/dragndrop"],function(e,t){var n=37;return function(r,i,s,o){function v(t){var s=t.data,o=s.id,u=s.name,a=document.createElement("div"),p=document.createElement("div"),v=document.createElement("div");p.className="menu",v.className="delete",p.appendChild(v),v.addEventListener("click",function(t){var n=new e({type:"iframe",modal:!0,url:r.ui.dialogDir+"delete-track.html",events:{open:function(e){n.send("trackdata",u)},submit:function(e){e.data===!0&&i.removeTrack(s),n.close()},cancel:function(e){n.close()},trackupdated:function(e){n.send("trackupdated",{success:!1})}}});n.trackupdated=function(e){console.log("called",e)},n.open()},!1),a.addEventListener("dblclick",function(t){var n=new e({type:"iframe",modal:!0,url:r.ui.dialogDir+"track-data.html",events:{open:function(e){n.send("trackdata",s.json)},submit:function(e){try{var t=JSON.parse(e.data),r=s.trackEvents,i=t.trackEvents,o={},u=[],f,l;a.childNodes[0].textContent=s.name=t.name;for(f=0,l=i.length;f<l;f++){var c=i[f],h=s.getTrackEventById(c.id);h?(h.update(c.popcornOptions),o[c.id]=c):u.push({type:c.type,popcornOptions:c.popcornOptions})}for(f=r.length,l=0;f>=l;f--)r[f]&&!o[r[f].id]&&s.removeTrackEvent(r[f]);for(f=0,l=u.length;f<l;f++)s.addTrackEvent(u[f]);n.send("trackupdated",!0)}catch(p){console.log(p),n.send("trackupdated",!1)}}}});n.open()},!1),h.push(p),a.className="track-handle",a.id="track-handle-"+o,a.setAttribute("data-butter-track-id",o),a.appendChild(document.createTextNode(u)),a.appendChild(p),d.addItem(a),f.appendChild(a),c[o]={id:o,track:s,element:a,menu:p},l.style.top=f.offsetHeight-n+"px"}var u=i,a=document.createElement("div"),f=document.createElement("div"),l=document.createElement("button"),c={},h=[],p=this;a.className="track-handle-container",f.className="handle-list",a.appendChild(f),l.id="add-track",l.innerHTML='<span class="icon icon-plus-sign"></span> Track',l.classList.add("butter-btn"),l.title="Add a new Track for your events",a.appendChild(l),l.addEventListener("click",function(e){r.currentMedia.addTrack()},!1);var d=t.sortable(f,{change:function(e){var t=[];for(var n=0,r=e.length;n<r;++n){var i=e[n].getAttribute("data-butter-track-id");t.push(c[i].track)}o(t)}}),m=u.tracks;for(var g=0;g<m.length;++g)v({data:m[g]});u.listen("trackadded",v),u.listen("trackremoved",function(e){var t=e.data.id;f.removeChild(c[t].element),d.removeItem(c[t].element),h.splice(h.indexOf(c[t].menu),1),delete c[t],l.style.top=f.offsetHeight-n+"px"}),s.element.addEventListener("scroll",function(e){a.scrollTop=s.element.scrollTop},!1),this.update=function(){a.scrollTop=s.element.scrollTop,l.style.top=f.offsetHeight-n+"px"},p.update(),Object.defineProperties(this,{element:{enumerable:!0,get:function(){return a}}})}}),n("util/scrollbars",["core/eventmanager"],function(e){function n(n,r){function p(){u=n.getBoundingClientRect().height,a=r.getBoundingClientRect().height,o=i.getBoundingClientRect().height,f=n.scrollHeight,l=o-(f-u)/t,l=Math.max(20,Math.min(o,l)),s.style.height=l+"px",g()}function d(){window.removeEventListener("mouseup",d,!1),window.removeEventListener("mousemove",v,!1),s.addEventListener("mousedown",m,!1)}function v(e){var t=e.pageY-c,r=o-l;t=Math.max(0,Math.min(t,r));var i=t/r;s.style.top=t+"px",n.scrollTop=(f-u)*i,h.dispatch("scroll",n.scrollTop)}function m(e){if(e.button===0){var t=s.offsetTop;c=e.pageY-t,window.addEventListener("mouseup",d,!1),window.addEventListener("mousemove",v,!1),s.removeEventListener("mousedown",m,!1)}}function g(){r.scrollHeight-o>0?s.style.top=(o-l)*(n.scrollTop/(n.scrollHeight-o))+"px":s.style.top="0px"}var i=document.createElement("div"),s=document.createElement("div"),o,u,a,f,l,c=0,h=this;e(h),i.className="scroll-bar scroll-bar-v",s.className="scroll-handle",i.appendChild(s),this.update=function(){p()},r.addEventListener("scroll",function(e){g()},!1),r.addEventListener("mousewheel",function(e){e.wheelDeltaY&&(n.scrollTop-=e.wheelDeltaY,g(),e.preventDefault())},!1),r.addEventListener("DOMMouseScroll",function(e){e.axis===e.VERTICAL_AXIS&&!e.shiftKey&&(r.scrollTop+=e.detail*2,g(),e.preventDefault())},!1),i.addEventListener("click",function(e){if(e.srcElement===s||e.button>0)return;var t=e.pageY,n=s.getBoundingClientRect(),u=i.getBoundingClientRect(),a;t>n.bottom?s.style.top=t-u.top-l+"px":t<n.top&&(s.style.top=t-u.top+"px"),a=s.offsetTop/(o-l),r.scrollTop=(f-o)*a},!1),window.addEventListener("resize",p,!1),s.addEventListener("mousedown",m,!1),p(),Object.defineProperties(this,{element:{enumerable:!0,get:function(){return i}}})}function r(t,n){function h(){o=t.getBoundingClientRect().width,u=n.getBoundingClientRect().width,s=r.getBoundingClientRect().width,a=n.scrollWidth,f=s-(a-o),f=Math.max(20,Math.min(s,f)),i.style.width=f+"px",m()}function p(){window.removeEventListener("mouseup",p,!1),window.removeEventListener("mousemove",d,!1),i.addEventListener("mousedown",v,!1)}function d(e){var t=e.pageX-l;t=Math.max(0,Math.min(t,s-f)),i.style.left=t+"px";var r=i.offsetLeft/(s-f);n.scrollLeft=(a-s)*r,c.dispatch("scroll",n.scrollLeft)}function v(e){if(e.button===0){var t=i.offsetLeft;l=e.pageX-t,window.addEventListener("mouseup",p,!1),window.addEventListener("mousemove",d,!1),i.removeEventListener("mousedown",v,!1)}}function m(){a-s>0?i.style.left=(s-f)*(n.scrollLeft/(a-s))+"px":i.style.left="0px"}var r=document.createElement("div"),i=document.createElement("div"),s,o,u,a,f,l=0,c=this;e(c),r.className="scroll-bar scroll-bar-h",i.className="scroll-handle",r.appendChild(i),n.addEventListener("scroll",function(e){m()},!1),n.addEventListener("mousewheel",function(e){e.wheelDeltaX&&(n.scrollLeft-=e.wheelDeltaX,m(),e.preventDefault())},!1),n.addEventListener("DOMMouseScroll",function(e){if(e.axis===e.HORIZONTAL_AXIS||e.axis===e.VERTICAL_AXIS&&e.shiftKey)n.scrollLeft+=e.detail*2,m(),e.preventDefault()},!1),r.addEventListener("click",function(e){if(e.srcElement===i||e.button>0)return;var t=e.pageX,o=i.getBoundingClientRect(),u=r.getBoundingClientRect(),l;t>o.right?i.style.left=t-u.left-f+"px":t<o.left&&(i.style.left=t-u.left+"px"),l=i.offsetLeft/(s-f),n.scrollLeft=(a-s)*l},!1),window.addEventListener("resize",h,!1),i.addEventListener("mousedown",v,!1),this.update=function(){h()},h(),Object.defineProperties(this,{element:{enumerable:!0,get:function(){return r}}})}var t=3;return{Vertical:n,Horizontal:r}}),n("plugin/plugin-list",["util/dragndrop"],function(e){return function(t){var n=document.createElement("div"),r=document.createElement("div");n.id="plugin-list",r.className="container",n.appendChild(r),t.ui.areas.work.addComponent(n,{states:["add-popcorn"],transitionIn:function(){n.style.display="block",setTimeout(function(){n.style.opacity="1"},0)},transitionOut:function(){n.style.opacity="0"},transitionInComplete:function(){},transitionOutComplete:function(){n.style.display="none"}}),t.listen("pluginadded",function(n){var i=document.createElement("div"),s=n.data.helper,o=document.createElement("span"),u=document.createElement("span");e.helper(i,{start:function(){var e=t.targets,n=t.currentMedia;n.view.blink();for(var r=0,i=e.length;r<i;++r)e[r].view.blink()},stop:function(){}}),s&&(o.style.backgroundImage="url('"+s.src+"')",o.className="icon",i.appendChild(o)),u.className="label",u.innerHTML=n.data.type,i.appendChild(u),i.setAttribute("data-butter-plugin-type",n.data.type),i.setAttribute("data-butter-draggable-type","plugin"),r.appendChild(i)}),n.style.display="none",n.classList.add("fadable")}}),n("dependencies",[],function(){var e={"popcorn-js":"../external/popcorn-js",css:"css"},t=/\{([\w\-\._]+)\}/,n=10,r=function(){var e=0;return function(){return e++>0}};return function(i){function o(n){var r,i;while(t.test(n))r=t.exec(n),i=s[r[1]]||e[r[1]]||"",n=n.replace(r[0],i);return n.replace("//","/")}function a(e,t){var n=0;return function(){++n,n===e.length&&t&&t()}}function f(e,t){function r(){n===e.length?t():l.load(e[n++],r)}var n=0;return r}var s=i.value("dirs"),u={js:function(e,t,n,i){i=i||r(),e=o(e);if(!i()){var s=document.createElement("script");s.src=e,s.type="text/javascript",document.head.appendChild(s),s.onload=s.onreadystatechange=n}else n&&n()},css:function(e,t,r,i,s){function f(){a=setInterval(function(){i()&&(clearInterval(a),r&&r())},n)}var u,a;i=i||function(){return!!u},e=o(e),i()?r&&r():(u=document.createElement("link"),u.rel="stylesheet",u.onload=f,u.onerror=s,u.href=e,document.head.appendChild(u))}},l={load:function(e,t,n,r){if(e instanceof Array&&e.length>0){var i=a(e,t);if(!r)for(var s=0;s<e.length;++s)l.load(e[s],i);else{var o=f(e,t);o()}}else{var c=e;if(!u[c.type])throw new Error("Loader type "+c.type+" not found! Attempted: "+c.url);if(!c.url)throw new Error("Attempted to load resource without url.");u[c.type](c.url,c.exclude,t,c.check,n)}}};return l}}),n("ui/toggler",[],function(){return function(e,t){var n=e,r=t,i=document.createElement("div"),s=document.createElement("div"),o=this;i.id="toggle-button",i.title="Show/Hide Timeline",i.appendChild(s),r.appendChild(i),i.addEventListener("click",function(e){n.ui.visible=!n.ui.visible},!1),Object.defineProperties(o,{visible:{enumerable:!0,get:function(){return i.style.display!=="none"},set:function(e){i.style.display=e?"block":"none"}}})}}),n("ui/context-button",[],function(){return function(e){var t=document.createElement("butter-button");t.id="add-popcorn",t.title="Add Popcorn Events to the timeline",t.classList.add("butter-btn"),t.innerHTML='<span class="icon icon-plus-sign"></span> Popcorn',t.addEventListener("click",function(){e.ui.contentState==="timeline"?(e.ui.setContentState("add-popcorn"),e.ui.contentStateLocked=!0):(e.ui.contentStateLocked=!1,e.ui.setContentState("timeline"))},!1),e.ui.areas.tools.addComponent(t,{states:["add-popcorn","editor"],transitionIn:function(){t.setAttribute("disabled",!0),t.innerHTML="Done",t.title="Finish adding Popcorn Events",t.classList.add("add-popcorn-done")},transitionInComplete:function(){t.removeAttribute("disabled")},transitionOut:function(){t.setAttribute("disabled",!0),t.innerHTML='<span class="icon icon-plus-sign"></span> Popcorn',t.title="Add Popcorn Events to the timeline",t.classList.remove("add-popcorn-done")},transitionOutComplete:function(){t.removeAttribute("disabled")}})}}),function(){function e(e){var t=[];if(!e)return null;for(var n in e)e.hasOwnProperty(n)&&(t[t.length]=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&").replace("/%20/g","+")}n("util/xhr",[],function(){function t(){var e=document.getElementById("csrf_token_id");e&&(n=e.value)}var n;document.readyState!=="loading"?t():document.addEventListener("DOMContentLoaded",t,!1);var r={get:function(e,t){var n=new XMLHttpRequest;n.open("GET",e,!0),n.onreadystatechange=t,n.setRequestHeader("X-Requested-With","XMLHttpRequest"),n.send(null)},post:function(t,r,i,s){var o=new XMLHttpRequest;o.open("POST",t,!0),o.onreadystatechange=i,o.setRequestHeader("X-Requested-With","XMLHttpRequest"),n&&o.setRequestHeader("X-CSRFToken",n),s?(o.setRequestHeader("Content-Type",s),o.send(r)):(o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.send(e(r)))}};return r})}(),n("cornfield/module",["util/xhr"],function(e){function t(){return location.protocol+"//"+location.hostname+(location.port?":"+location.port:"")}var n=function(n,r){var i=!1,s="",o="",u="",a=t();if(!navigator.id){var f=document.createElement("script");f.src="https://browserid.org/include.js",f.type="text/javascript",f.setAttribute("data-butter-exclude",!0),document.head.appendChild(f)}this.login=function(t){navigator.id.get(function(r){r?e.post(a+"/browserid/verify",{audience:a,assertion:r},function(){if(this.readyState===4)try{var e=JSON.parse(this.response);if(e.status==="okay"){n.cornfield.whoami(function(e){t(e)});return}t(e)}catch(r){t({error:"an unknown error occured"})}}):t(undefined)})},this.whoami=function(t){e.get(a+"/api/whoami",function(){if(this.readyState===4){var e;try{e=JSON.parse(this.response),this.status===200&&(i=!0,s=e.email,u=e.username,o=e.name)}catch(n){e={error:"failed to parse data from server: \n"+this.response}}t&&t(e)}})},n.listen("ready",function l(){n.unlisten("ready",l),n.cornfield.whoami(function(e){e.error||n.dispatch("autologinsucceeded",e)})}),this.email=function(){return s},this.name=function(){return o},this.username=function(){return u},this.authenticated=function(){return i},this.publish=function(t,n){e.post(a+"/api/publish/"+t,null,function(){if(this.readyState===4)try{var e=JSON.parse(this.response);n(e)}catch(t){n({error:"an unknown error occured"})}})},this.logout=function(t){e.get(a+"/browserid/logout",function(){s="";if(this.readyState===4){var e;try{e=JSON.parse(this.response),i=!1,s="",u="",o=""}catch(n){e={error:"an unknown error occured"}}t&&t(e)}})},this.list=function(t){e.get(a+"/api/projects",function(){if(this.readyState===4)try{var e=JSON.parse(this.response);t(e)}catch(n){t({error:"an unknown error occured"})}})},this.load=function(t,n){e.get(a+"/api/project/"+t,function(){if(this.readyState===4)try{var e=JSON.parse(this.response);n(e)}catch(t){n({error:"an unknown error occured"})}})},this.save=function(t,n,r){var i=a+"/api/project/";t&&(i+=t),e.post(i,n,function(){if(this.readyState===4)try{var e=JSON.parse(this.response);r(e)}catch(t){r({error:"an unknown error occured"})}},"application/json")}};return n.__moduleName="cornfield",n}),n("util/lang",[],function(){if("Range"in window&&!Range.prototype.createContextualFragment){var e={getDocument:function(t){if(t.nodeType===9)return t;if(typeof t.ownerDocument!="undefined")return t.ownerDocument;if(typeof t.document!="undefined")return t.document;if(t.parentNode)return this.getDocument(t.parentNode);throw"No document found for node."},isCharacterDataNode:function(e){var t=e.nodeType;return t===3||t===4||t===8},parentElement:function(e){var t=e.parentNode;return t.nodeType===1?t:null},isHtmlNamespace:function(e){var t;return typeof e.namespaceURI=="undefined"||(t=e.namespaceURI)===null||t==="http://www.w3.org/1999/xhtml"},fragmentFromNodeChildren:function(e){var t=this.getDocument(e).createDocumentFragment(),n;while(!!(n=e.firstChild))t.appendChild(n);return t}};Range.prototype.createContextualFragment=function(t){var n=this.startContainer,r=e.getDocument(n);if(!n)throw new DOMException("INVALID_STATE_ERR");var i=null;return n.nodeType===1?i=n:e.isCharacterDataNode(n)&&(i=e.parentElement(n)),i===null||i.nodeName==="HTML"&&e.isHtmlNamespace(e.getDocument(i).documentElement)&&e.isHtmlNamespace(i)?i=r.createElement("body"):i=i.cloneNode(!1),i.innerHTML=t,e.fragmentFromNodeChildren(i)}}return typeof document!="undefined"&&!("classList"in document.createElement("a"))&&function(e){var t="classList",n="prototype",r=(e.HTMLElement||e.Element)[n],i=Object,s=String[n].trim||function(){return this.replace(/^\s+|\s+$/g,"")},o=Array[n].indexOf||function(e){var t=0,n=this.length;for(;t<n;t++)if(t in this&&this[t]===e)return t;return-1},u=function(e,t){this.name=e,this.code=DOMException[e],this.message=t},a=function(e,t){if(t==="")throw new u("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(t))throw new u("INVALID_CHARACTER_ERR","String contains an invalid character");return o.call(e,t)},f=function(e){var t=s.call(e.className),n=t?t.split(/\s+/):[],r=0,i=n.length;for(;r<i;r++)this.push(n[r]);this._updateClassName=function(){e.className=this.toString()}},l=f[n]=[],c=function(){return new f(this)};u[n]=Error[n],l.item=function(e){return this[e]||null},l.contains=function(e){return e+="",a(this,e)!==-1},l.add=function(e){e+="",a(this,e)===-1&&(this.push(e),this._updateClassName())},l.remove=function(e){e+="";var t=a(this,e);t!==-1&&(this.splice(t,1),this._updateClassName())},l.toggle=function(e){e+="",a(this,e)===-1?this.add(e):this.remove(e)},l.toString=function(){return this.join(" ")};if(i.defineProperty){var h={get:c,enumerable:!0,configurable:!0};try{i.defineProperty(r,t,h)}catch(p){p.number===-2146823252&&(h.enumerable=!1,i.defineProperty(r,t,h))}}else i[n].__defineGetter__&&r.__defineGetter__(t,c)}(self),{extend:function(e){var t=e,n=[].slice.call(arguments,1);n.forEach(function(e){for(var n in 
e)e.hasOwnProperty(n)&&(t[n]=e[n])})},smpteToSeconds:function(e){var t=e.split(":");if(t.length===1)return parseFloat(t[0],10);if(t.length===2)return parseFloat(t[0],10)+parseFloat(t[1]/12,10);if(t.length===3)return parseInt(t[0]*60,10)+parseFloat(t[1],10)+parseFloat(t[2]/12,10);if(t.length===4)return parseInt(t[0]*3600,10)+parseInt(t[1]*60,10)+parseFloat(t[2],10)+parseFloat(t[3]/12,10)},secondsToSMPTE:function(e){var t=new Date(1970,0,1),n;return t.setSeconds(e),n=t.toTimeString().substr(0,8),n>86399&&(n=Math.floor((t-Date.parse("1/1/70"))/36e5)+n.substr(2)),n},clone:function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t},defaults:function(e,t){for(var n in t)e[n]===undefined&&(e[n]=t[n]);return e},domFragment:function(e){var t=document.createRange(),n;t.selectNode(document.body.firstChild),n=t.createContextualFragment(e);if(n.childNodes.length===1){var r=n.firstChild;return n.removeChild(r),r}return n}}}),n("core/trackevent",["./logger","./eventmanager","util/lang","util/time","./views/trackevent-view"],function(e,t,n,r,i){var s=0,o=function(o){function g(e){return e.default?e.default:e.type==="number"?0:""}o=o||{};var u=this,a="TrackEvent"+s++,f=o.name||a,l=new e(a),c,h=o.type+"",p=o.popcornOptions||{start:0,end:1},d=new i(this,h,p),v=null,m=!1;t(u),u.popcornOptions=p,u.popcornTrackEvent=null,h||l.log("Warning: "+a+" has no type."),p.start=p.start||0,p.start=r.roundTime(p.start),p.end=p.end||p.start+1,p.end=r.roundTime(p.end),this.setPopcornWrapper=function(e){v=e},this.update=function(e,t){e=e||{};var n=!1,i=p.start,s=p.end;isNaN(e.start)||(i=r.roundTime(e.start)),isNaN(e.end)||(s=r.roundTime(e.end));if(i>=s)n="invalidtime";else if(c&&c._media){var o=c._media;if(i>o.duration||s>o.duration||i<0)n="invalidtime"}if(n)u.dispatch("trackeventupdatefailed",n);else{var a=Popcorn.manifest[h]&&Popcorn.manifest[h].options;if(a){for(var f in a)a.hasOwnProperty(f)&&(e[f]===undefined?t&&(p[f]=g(a[f])):p[f]=e[f]);!("target"in a)&&e.target&&(p.target=e.target)}i&&(p.start=i),s&&(p.end=s),d.update(p),u.popcornOptions=p,v&&v.updateEvent(u),u.dispatch("trackeventupdated",u)}},this.moveFrameLeft=function(e,t){t?p.end-p.start>e?p.end-=e:p.end=p.start:p.start>e?(p.start-=e,p.end-=e):(p.end=p.end-p.start,p.start=0),u.dispatch("trackeventupdated",u),d.update(p)},this.moveFrameRight=function(e,t){p.end<c._media.duration-e?(p.end+=e,t||(p.start+=e)):(t||(p.start+=c._media.duration-p.end),p.end=c._media.duration),u.dispatch("trackeventupdated",u),d.update(p)},Object.defineProperties(this,{_track:{enumerable:!0,get:function(){return c},set:function(e){c=e,c&&u.update(p)}},view:{enumerable:!0,configurable:!1,get:function(){return d}},type:{enumerable:!0,get:function(){return h}},name:{enumerable:!0,get:function(){return f}},id:{enumerable:!0,get:function(){return a}},selected:{enumerable:!0,get:function(){return m},set:function(e){e!==m&&(m=e,d.selected=m,m?u.dispatch("trackeventselected"):u.dispatch("trackeventdeselected"))}},json:{enumerable:!0,get:function(){return{id:a,type:h,popcornOptions:n.clone(p),track:c?c.name:undefined,name:f}},set:function(e){h=p.type=e.type,e.name&&(f=e.name),p=e.popcornOptions,u.popcornOptions=p,d.type=h,d.update(p),u.dispatch("trackeventupdated",u)}}})};return o}),n("core/track",["./logger","./eventmanager","./trackevent","./views/track-view"],function(e,t,n,r){var i=0,s=function(s){s=s||{};var o=[],u="Track"+i++,a=s.target,f=new e(u),l=s.name||u,c=s.order||0,h=new r(this),p=null,d=this;d._media=null,t(d),this.setPopcornWrapper=function(e){p=e;for(var t=0,n=o.length;t<n;++t)o[t].setPopcornWrapper(e)},Object.defineProperties(this,{view:{enumerable:!0,configurable:!1,get:function(){return h}},order:{enumerable:!0,get:function(){return c},set:function(e){c=e,d.dispatch("trackorderchanged",c)}},target:{enumerable:!0,get:function(){return a},set:function(e){a=e,d.dispatch("tracktargetchanged",d);for(var t=0,n=o.length;t<n;t++)o[t].target=e,o[t].update({target:e});f.log("target changed: "+e)}},name:{enumerable:!0,get:function(){return l},set:function(e){l=e,d.dispatch("tracknamechanged",d)}},id:{enumerable:!0,configurable:!1,get:function(){return u}},json:{enumerable:!0,get:function(){var e=[];for(var t=0,n=o.length;t<n;++t)e.push(o[t].json);return{name:l,id:u,trackEvents:e}},set:function(e){e.name&&(l=e.name);if(e.trackEvents){var t=e.trackEvents;for(var r=0,i=t.length;r<i;++r){var s=new n;s.json=t[r],d.addTrackEvent(s)}}}},trackEvents:{enumerable:!0,configurable:!1,get:function(){return o}}}),this.getTrackEventById=function(e){for(var t=0,n=o.length;t<n;++t)if(o[t].id===e)return o[t]},this.getTrackEventByName=function(e){for(var t=0,n=o.length;t<n;++t)if(o[t].name===e)return o[t]},this.addTrackEvent=function(e){return e instanceof n||(e=new n(e),e.update(e.popcornOptions,!0)),a&&(e.target=a),e._track=d,o.push(e),e.track=d,d.chain(e,["trackeventupdated","trackeventselected","trackeventdeselected","trackeventeditrequested"]),h.addTrackEvent(e),e.track=d,e.setPopcornWrapper(p),d.dispatch("trackeventadded",e),e},this.removeTrackEvent=function(e){var t=o.indexOf(e);if(t>-1)return o.splice(t,1),d.unchain(e,["trackeventupdated","trackeventselected","trackeventdeselected","trackeventeditrequested"]),h.removeTrackEvent(e),e._track=null,e.setPopcornWrapper(null),d.dispatch("trackeventremoved",e),e},this.deselectEvents=function(e){for(var t=0,n=o.length;t<n;++t)o[t]!==e&&(o[t].selected=!1)}};return s}),function(){n("editor/module",["core/eventmanager","core/trackevent","./editor"],function(e,t,n){function r(r,i){function f(e){u.frame==="iframe"&&r.ui.contentState==="editor"&&r.ui.popContentState("editor"),u.unlisten("close",f),u=null}function l(e){u.frame==="iframe"&&r.ui.contentState!=="editor"&&r.ui.pushContentState("editor")}function c(e){a.edit(e.target.trackEvent)}i=i||{};var s={},o,u,a=this;e(a),r.listen("trackeventcreated",function(e){["target","media"].indexOf(e.data.by)>-1&&r.ui.contentState==="timeline"&&a.edit(e.data.trackEvent)}),this.edit=function(e){if(!e||!(e instanceof t))throw new Error("trackEvent must be valid to start an editor.");var n=e.type;s[n]||(n="default");if(!u){var r=s[n];if(!r)throw new Error("Editor "+n+" not found.");u=r,r.listen("open",l),r.open(e),r.listen("close",f)}},this.add=function(e,t,i){if(!t||!e)throw new Error("Can't create an editor without a plugin type and editor source");var u=s[t]=new n(r,e,t,i,o);return u},this.remove=function(e){if(!e)return;var t=s[e];return s[e]=undefined,t},r.listen("trackeventadded",function(e){e.data.view.listen("trackeventdoubleclicked",c,!1)}),r.listen("trackeventremoved",function(e){e.data.view.unlisten("trackeventdoubleclicked",c,!1)}),this._start=function(e){var t=document.createElement("div");t.id="butter-editor",o=document.createElement("div"),o.id="editor-container",t.appendChild(o),t.classList.add("fadable"),r.ui.areas.work.addComponent(t,{states:["editor"],transitionIn:function(){t.style.display="block",setTimeout(function(){t.style.opacity="1"},0)},transitionInComplete:function(){},transitionOut:function(){u&&u.close(),t.style.opacity="0"},transitionOutComplete:function(){t.style.display="none"}}),t.style.display="none";for(var n in i)i.hasOwnProperty(n)&&a.add(i[n],n);e()},r.listen("trackeventeditrequested",function(e){a.edit(e.target)})}return r.__moduleName="editor",r})}(),n("timeline/timebar",["util/lang","./scrubber"],function(e,t){var n=5;return function(r,i,s,o){function p(t){var r=s.container.getBoundingClientRect().width,i=Math.min(r,c.container.scrollWidth),o=Math.min(i,c.element.offsetWidth-n);f.style.width=o+"px";var u=a.getContext("2d");a.height!==a.offsetHeight&&(a.height=a.offsetHeight),a.width!==o&&(a.width=o);var p=c.element.firstChild.clientWidth/l.duration,d=u.measureText(e.secondsToSMPTE(5)).width,v=20,m=0,g=-((d+v)/2),y=c.element.scrollLeft/p,b=(c.element.scrollLeft+o)/p;u.clearRect(0,0,a.width,a.height),u.translate(-c.element.scrollLeft,0),u.beginPath();for(var w=1,E=l.duration+1;w<E;w++){if(w+1<y)continue;if(w-1>b)break;var S=w*p,x=-~S+~m;x>3&&(x>6&&(u.moveTo(-~S-x/2,0),u.lineTo(-~S-x/2,7),x>12&&(u.moveTo(-~S-x/4*3,0),u.lineTo(-~S-x/4*3,4),u.moveTo(-~S-x/4,0),u.lineTo(-~S-x/4,4))),u.moveTo(-~S,0),u.lineTo(-~S,10),S-g>d+v&&(g=S,u.fillStyle="#999999",u.fillText(e.secondsToSMPTE(w),-~S-d/2,21)),m=S)}u.strokeStyle="#999999",u.stroke(),u.translate(c.element.scrollLeft,0),h.update(o,t)}var u=document.createElement("div"),a=document.createElement("canvas"),f=document.createElement("div"),l=i,c=s,h=new t(r,u,l,c,o);u.className="time-bar",f.className="time-bar-canvas-container",f.appendChild(a),u.appendChild(f),a.addEventListener("mousedown",h.onMouseDown,!1),c.element.addEventListener("scroll",p,!1),window.addEventListener("resize",p,!1),this.update=function(e){p(e)},this.destroy=function(){h.destroy()},Object.defineProperties(this,{element:{enumerable:!0,get:function(){return u}}})}}),n("timeline/media",["core/trackevent","core/track","core/eventmanager","./track-container","./scrollbars","./timebar","./zoombar","./status","./trackhandles","util/lang"],function(e,t,n,r,i,s,o,u,a,f){function h(e,t){function f(e){v.orderTracks(e)}function h(e){var t=l*e+A;t!==O&&(O=t,v.zoom=O,U())}function M(){v.snapTo(d.currentTime),w.update()}function _(t){t!==d.target?(t=e.getTargetByType("elementID",t),t&&t.view.blink()):d.view.blink()}function D(e){var t=e.trackEvent,n=t.popcornOptions;n.target&&_(n.target)}function P(e){}function H(e){if(L&&k==="click"){var t=L.popcornOptions;t.target&&_(t.target)}}function B(e){L=null}function j(t){var n=t.data.trackEvent,r=t.data.originalEvent;L=n,n.selected=!0;if(!r.shiftKey){var i=d.tracks;for(var s in i)i.hasOwnProperty(s)&&i[s].deselectEvents(n);e.selectedEvents=[n]}else e.selectedEvents.push(n)}function F(){A=g.clientWidth/d.duration,O=c,T.zoom(O),v.zoom=O,U(),p.dispatch("ready")}function I(){function t(e){var t=e.data;t.view.listen("trackeventdragstarted",B),t.view.listen("trackeventmouseup",H),t.view.listen("trackeventmousedown",j),k==="hover"&&(t.view.listen("trackeventmouseover",D),t.view.listen("trackeventmouseout",P))}function n(e){var n=e.data;n.view.listen("plugindropped",q),n.view.listen("trackeventdropped",R),n.view.listen("trackeventmousedown",j),k==="hover"&&(n.view.listen("trackeventmouseover",D),n.view.listen("trackeventmouseout",P));var r=n.trackEvents;for(var i=0;i<r.length;++i)t({data:r[i]})}d.unlisten("mediaready",I),d.listen("mediaready",F),g.appendChild(v.element),g.appendChild(w.element),g.appendChild(E.element),y.appendChild(x.element),y.appendChild(N.statusElement),y.appendChild(N.muteElement),e.ui.areas.statusbar.element.appendChild(y),m.appendChild(C.element),m.appendChild(T.element),m.appendChild(g),d.listen("trackeventremoved",function(e){var t=e.data;t.view.unlisten("trackeventdragstarted",B),t.view.unlisten("trackeventmouseup",H),t.view.unlisten("trackeventmousedown",j),k==="hover"&&(t.view.unlisten("trackeventmouseover",D),t.view.unlisten("trackeventmouseout",P))});var r=d.tracks;for(var i=0;i<r.length;++i)n({data:r[i]});d.listen("trackadded",n),d.listen("trackeventadded",t),d.listen("trackremoved",function(e){var t=e.data;t.view.unlisten("plugindropped",q),t.view.unlisten("trackeventdropped",R),t.view.listen("trackeventmousedown",j),k==="hover"&&(t.view.listen("trackeventmouseover",D),t.view.listen("trackeventmouseout",P))}),F()}function q(t){var n=t.data.type,r=t.data.track,i=t.data.start;i+1>d.duration&&(i=d.duration-1);var s=e.defaultTarget;!s&&e.targets.length>0&&(s=e.targets[0]),r.addTrackEvent({popcornOptions:{start:i,end:i+1,target:s.elementID},type:n}),s&&s.view.blink()}function R(e){var t=d.findTrackWithTrackEventId(e.data.trackEvent),n=t.trackEvent,r=n.popcornOptions;t.track.removeTrackEvent(n);var i=r.end-r.start;r.start=e.data.start,r.end=r.start+i,n.update(r),e.data.track.addTrackEvent(n)}function U(){d.duration&&(v.update(),x.update(O),w.update(),E.update(),T.update(),C.update())}var p=this,d=t,v=new r(e,t),m=document.createElement("div"),g=document.createElement("div"),y=document.createElement("div"),b=[],w=new i.Horizontal(v),E=new i.Vertical(v,m),S=!1,x=new s(e,d,v,w),T=new o(h),N=new u(d),C=new a(e,d,v,f),k=e.config.value("ui").trackEventHighlight||"click",L,A,O;v.setScrollbars(w,E),n(p),m.className="media-instance",m.id="media-instance"+t.id,g.className="media-container",y.className="media-status-container",d.listen("mediaplaying",M),d.listen("mediapause",M),d.listen("trackeventselected",function(e){b.push(e.target)}),d.listen("trackeventdeselected",function(e){b.splice(b.indexOf(e.target),1)}),d.listen("mediaready",I),this.destroy=function(){m.parentNode.removeChild(m),y.parentNode&&e.ui.areas.statusbar.element.removeChild(y),x.destroy()},this.hide=function(){m.style.display="none"},this.show=function(){m.style.display="block"},e.listen("ready",function(){U()}),v.zoom=O,Object.defineProperties(this,{zoom:{enumerable:!0,get:function(){return O},set:function(e){O=e,U()}},element:{enumerable:!0,configurable:!1,get:function(){return m}},media:{enumerable:!0,configurable:!1,get:function(){return d}},shrunken:{enumerable:!0,configurable:!1,get:function(){return S},set:function(e){e!==S&&(S=e)}}})}var l=300,c=.5;return h}),n("timeline/module",["core/logger","./media"],function(e,t){var n=function(e,n){var r={},i,s=document.createElement("div");s.id="butter-timeline",s.classList.add("fadable"),this._start=function(t){e.ui.areas.work.addComponent(s,{states:["timeline"],transitionIn:function(){s.style.visibility="visible",setTimeout(function(){s.style.opacity="1"},0)},transitionInComplete:function(){},transitionOut:function(){s.style.opacity="0"},transitionOutComplete:function(){s.style.visibility="hidden"}}),e.ui.registerStateToggleFunctions("timeline",{transitionIn:function(){s.removeAttribute("data-butter-disabled")},transitionOut:function(){s.setAttribute("data-butter-disabled",!0)}}),e.ui.pushContentState("timeline"),t()},e.ui&&e.ui.listen("uivisibilitychanged",function(e){for(var t in r)r.hasOwnProperty(t)&&(r[t].shrunken=!e.data)}),this.findAbsolutePosition=function(e){var t=0,n=0;if(e.offsetParent)do t+=e.offsetLeft,n+=e.offsetTop;while(e=e.offsetParent);return[t,n]},e.listen("mediaadded",function(n){function a(t){i!==r[t.data.id]&&(i&&i.hide(),i=r[t.data.id],i&&i.show(),e.dispatch("timelineready"))}function f(t){var n=t.data;r[n.id]&&r[n.id].destroy(),delete r[n.id],i&&n.id===i.media.id&&(i=undefined),e.unlisten("mediachanged",a),e.unlisten("mediaremoved",f)}var o=n.data,u=new t(e,o);r[o.id]=u,s.appendChild(u.element),e.listen("mediachanged",a),e.listen("mediaremoved",f)}),Object.defineProperties(this,{zoom:{get:function(){return i.zoom},set:function(e){i.zoom=e}}})};return n.__moduleName="timeline",n}),n("plugin/plugin",["util/dragndrop","util/lang"],function(e,t){var n="butter-plugin-";return function(r,i){i=i||{};var s="plugin"+r,o=this,u=i.type,a=i.path,f={},l=i.type,c=document.getElementById(o.type+"-icon")||document.getElementById("default-icon");if(a&&!Popcorn.manifest[l]){var h=document.getElementsByTagName("HEAD")[0],p=document.createElement("script");p.src=a,h.appendChild(p)}Object.defineProperties(this,{id:{enumerable:!0,get:function(){return s}},name:{enumerable:!0,get:function(){return u}},path:{enumerable:!0,get:function(){return a}},manifest:{enumerable:!0,get:function(){return f},set:function(e){f=e}},type:{enumerable:!0,get:function(){return l}},helper:{enumerable:!0,get:function(){return c}}}),c=document.getElementById(o.type+"-icon")||document.getElementById("default-icon"),c&&(c=c.cloneNode(!1)),this.createElement=function(r,i){var s;if(!i)s=document.createElement("span"),s.innerHTML=o.type+" ";else{var u=i.replace(/\$type/g,o.type);s=t.domFragment(u)}return s.id=n+o.type,s.setAttribute("data-butter-plugin-type",o.type),s.setAttribute("data-butter-draggable-type","plugin"),e.helper(s,{image:c,start:function(){var e=r.targets,t=r.currentMedia;t.view.blink();for(var n=0,i=e.length;n<i;++n)e[n].view.blink()},stop:function(){}}),this.element=s,s}}}),function(){n("plugin/module",["core/logger","util/dragndrop","util/scrollbars","./plugin-list","./plugin"],function(e,t,n,r,i){function f(e){var t=0,n=0,r=0,i=e;while(i.length<9)i+=e;t=(i.charCodeAt(0)+i.charCodeAt(3)+i.charCodeAt(6))%(i.charCodeAt(8)*5%360),n=(i.charCodeAt(0)+i.charCodeAt(2)+i.charCodeAt(4)+i.charCodeAt(6))%100*.05+95,r=(i.charCodeAt(1)+i.charCodeAt(3)+i.charCodeAt(5)+i.charCodeAt(7))%100*.2+40;if(t<20||t>340)r+=10;return t>160&&t<200&&(r-=10),{h:t,s:n,l:r}}function l(e){var t="",n=f(e);t+=u+"["+o+'="'+e+'"]{',t+="background: hsl( "+n.h+", "+n.s+"%, "+n.l+"% );",t+="}",a.innerHTML=a.innerHTML+t}var s={},o="data-butter-trackevent-type",u="#butter-timeline .butter-track-event",a=document.createElement("style");a.type="text/css",a.media="screen",a.setAttribute("data-butter-exclude","true");var c=function(e,o){var u=[],f=document.createElement("div"),c=document.createElement("div"),h=document.createElement("div"),p=this,d='<div class="list-item $type_tool">$type</div>';f.id="butter-plugin",h.className="list",c.className="list-wrapper";var v=document.createElement("div");v.className="title",v.innerHTML="<span>My Events</span>",f.appendChild(v),c.appendChild(h),f.appendChild(c);var m=new n.Vertical(c,h);f.appendChild(m.element),this._start=function(t){e.ui&&(document.head.appendChild(a),e.ui.areas.tools.addComponent(f),r(e)),o&&o.plugins?p.add(o.plugins,t):t()},this.add=function(t,n){if(t instanceof Array){var r=0,a=0,f=0,c=function(){++r===t.length&&n&&n()};for(a=0,f=t.length;a<f;a++)p.add(t[a],c)}else{s[t.type]||l(t.type),t=new i(u.length,t);var v=setInterval(function(e){if(!Popcorn.manifest[t.type])return;t.manifest=Popcorn.manifest[t.type],clearInterval(v),n&&n()},100);u.push(t),o.defaults&&o.defaults.indexOf(t.type)>-1&&h.appendChild(t.createElement(e,d)),e.dispatch("pluginadded",t)}return m.update(),t},this.remove=function(t){if(typeof t=="string"){t=this.get(t);if(!t)return}var n,r;for(n=0,r=u.length;n<r;n++)if(u[n].name===t.name){var i=e.tracks;for(n=0,r=i.length;n<r;n++){var s=i[n].trackEvents;for(var o=0,a=s.length-1;a>=o;a--)s[a].type===t.name&&i[n].removeTrackEvent(s[a])}u.splice(n,1),r--,h.removeChild(t.element);var f=document.getElementsByTagName("HEAD")[0];for(n=0,r=f.children.length;n<r;n++)f.children[n].getAttribute("src")===t.path&&f.removeChild(f.children[n]);e.dispatch("pluginremoved",t)}m.update()},this.clear=function(){while(u.length>0){var t=u.pop();h.removeChild(t.element),e.dispatch("pluginremoved",t)}},this.get=function(e){for(var t=0,n=u.length;t<n;++t)if(u[t].name===e)return u[t]},t.droppable(f,{drop:function(t){if(t.getAttribute("data-butter-draggable-type")==="plugin"){var n=t.getAttribute("data-butter-plugin-type"),r=p.get(n);if(r){for(var i=0;i<h.childNodes.length;++i)if(h.childNodes[i].getAttribute("data-butter-plugin-type")===n)return;h.appendChild(r.createElement(e,d))}}}})};return c.__moduleName="plugin",c})}(),n("modules",["editor/module","timeline/module","cornfield/module","plugin/module"],function(){var e=Array.prototype.slice.apply(arguments);return function(t,n,r){var i=[],s=0,o=0;for(var u=0;u<e.length;++u){var a=e[u].__moduleName;t[a]=new e[u](t,n.value(a)),i.push(t[a])}return{load:function(e){function t(){s++,s===i.length&&e()}for(var n=0;n<i.length;++n)i[n]._load?i[n]._load(t):s++;s===i.length&&e()},ready:function(e){function t(){o++,o===i.length&&e()}for(var n=0;n<i.length;++n)i[n]._start?i[n]._start(t):o++}}}}),function(){var e=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],r=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,i=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,s=typeof location!="undefined"&&location.href,o=s&&location.protocol&&location.protocol.replace(/\:/,""),u=s&&location.hostname,a=s&&(location.port||void 0),f=[];n("text",[],function(){var n,l;return n={version:"1.0.8",strip:function(e){if(e){var e=e.replace(r,""),t=e.match(i);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r")},createXhr:function(){var t,n,r;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")for(n=0;n<3;n++){r=e[n];try{t=new ActiveXObject(r)}catch(i){}if(t){e=[r];break}}return t},parseName:function(e){var t=!1,n=e.indexOf("."),r=e.substring(0,n),e=e.substring(n+1,e.length),n=e.indexOf("!");return n!==-1&&(t=e.substring(n+1,e.length),t=t==="strip",e=e.substring(0,n)),{moduleName:r,ext:e,strip:t}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,t,r,i){var s=n.xdRegExp.exec(e),o;return s?(e=s[2],s=s[3],s=s.split(":"),o=s[1],s=s[0],(!e||e===t)&&(!s||s===r)&&(!o&&!s||o===i)):!0},finishLoad:function(e,t,r,i,s){r=t?n.strip(r):r,s.isBuild&&(f[e]=r),i(r)},load:function(e,t,r,i){if(i.isBuild&&!i.inlineText)r();else{var f=n.parseName(e),l=f.moduleName+"."+f.ext,c=t.toUrl(l),h=i&&i.text&&i.text.useXhr||n.useXhr;!s||h(c,o,u,a)?n.get(c,function(t){n.finishLoad(e,f.strip,t,r,i)}):t([l],function(e){n.finishLoad(f.moduleName+"."+f.ext,f.strip,e,r,i)})}},write:function(e,t,r){if(f.hasOwnProperty(t)){var i=n.jsEscape(f[t]);r.asModule(e+"!"+t,"define(function () { return '"+i+"';});\n")}},writeFile:function(e,t,r,i,s){var t=n.parseName(t),o=t.moduleName+"."+t.ext,u=r.toUrl(t.moduleName+"."+t.ext)+".js";n.load(o,r,function(){var t=function(e){return i(u,e)};t.asModule=function(e,t){return i.asModule(e,u,t)},n.write(e,o,t,s)},s)}},n.createXhr()?n.get=function(e,t){var r=n.createXhr();r.open("GET",e,!0),r.onreadystatechange=function(){r.readyState===4&&t(r.responseText)},r.send(null)}:typeof process!="undefined"&&process.versions&&process.versions.node?(l=t.nodeRequire("fs"),n.get=function(e,t){var n=l.readFileSync(e,"utf8");n.indexOf("")===0&&(n=n.substring(1)),t(n)}):typeof Packages!="undefined"&&(n.get=function(e,t){var n=new java.io.File(e),r=java.lang.System.getProperty("line.separator"),n=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(n),"utf-8")),i,s,o="";try{i=new java.lang.StringBuffer,(s=n.readLine())&&s.length()&&s.charAt(0)===65279&&(s=s.substring(1));for(i.append(s);(s=n.readLine())!==null;)i.append(r),i.append(s);o=String(i.toString())}finally{n.close()}t(o)}),n})}(),n("text!default-config.json",[],function(){return'{\n  "name": "default-config",\n  "baseDir": "../",\n  "snapshotHTMLOnReady": true,\n  "scrapePage": true,\n  "title": "Popcorn Maker",\n  "editor": {\n    "default": "{{baseDir}}editors/default-editor.html",\n    "googlemap": "{{baseDir}}editors/googlemap-editor.html"\n  },\n  "ui": {\n    "enabled": true,\n    "trackEventHighlight": "click"\n  },\n  "mediaDefaults": {\n    "frameAnimation": true\n  },\n  "plugin": {\n    "plugins": [\n      {\n        "type": "attribution",\n        "path": "{{baseDir}}external/popcorn-js/plugins/attribution/popcorn.attribution.js"\n      },\n      {\n        "type": "webpage",\n        "path": "{{baseDir}}external/popcorn-js/plugins/webpage/popcorn.webpage.js"\n      },\n      {\n        "type": "text",\n        "path": "{{baseDir}}external/popcorn-js/plugins/text/popcorn.text.js"\n      },\n      {\n        "type": "googlemap",\n        "path": "{{baseDir}}external/popcorn-js/plugins/googlemap/popcorn.googlemap.js"\n      },\n      {\n        "type": "image",\n        "path": "{{baseDir}}external/popcorn-js/plugins/image/popcorn.image.js"\n      },\n      {\n        "type": "twitter",\n        "path": "{{baseDir}}external/popcorn-js/plugins/twitter/popcorn.twitter.js"\n      },\n      {\n        "type": "wikipedia",\n        "path": "{{baseDir}}external/popcorn-js/plugins/wikipedia/popcorn.wikipedia.js"\n      }\n    ],\n    "defaults": [\n      "text",\n      "image",\n      "googlemap"\n    ]\n  },\n  "player": {\n    "players": [\n      {\n        "type": "youtube",\n        "path": "{{baseDir}}external/popcorn-js/players/youtube/popcorn.youtube.js"\n      },\n      {\n        "type": "soundcloud",\n        "path": "{{baseDir}}external/popcorn-js/players/soundcloud/popcorn.soundcloud.js"\n      },\n      {\n        "type": "vimeo",\n        "path": "{{baseDir}}external/popcorn-js/players/vimeo/popcorn.vimeo.js"\n      }\n    ],\n    "defaults": [\n      "youtube",\n      "soundcloud",\n      "vimeo"\n    ]\n  },\n  "dirs": {\n    "popcorn-js": "{{baseDir}}external/popcorn-js/",\n    "css": "{{baseDir}}css/",\n    "dialogs": "{{baseDir}}dialogs/",\n    "resources": "{{baseDir}}resources/"\n  },\n  "icons": {\n    "default": "popcorn-icon.png",\n    "image": "image-icon.png"\n  }\n}\n'}),n("text!layouts/ua-warning.html",[],function(){return'<div class="butter-ua-warning" data-butter-exclude>Your web browser may lack some functionality expected by Butter to function properly. Please upgrade your browser or <a href="https://webmademovies.lighthouseapp.com/projects/65733-popcorn-maker">file a bug</a> to find out why your browser isn\'t fully supported. Click <a href="#" class="close-button">here</a> to remove this warning.</div>'}),n("text!layouts/media-view.html",[],function(){return'<div class="butter-media-properties" data-butter-exclude="true">\n  <p class="butter-edit-message">Edit source...</p>\n  <div class="butter-container">\n    <div class="butter-inner-container">\n      <div class="butter-inner-container-title">Video/Audio URL</div>\n      <div class="butter-url-group">\n        <div class="butter-url fade-in"><input type="text" /><button class="butter-btn butter-btn-remove"><span class="icon-minus"></span></button></div>\n      </div>\n      <p class="butter-form-field-notes"></p>\n      <button class="butter-btn butter-btn-save">Save</button><button class="butter-btn butter-btn-add-url">Add Alternate URL</button>\n      <div class="butter-loading-container"></div>\n    </div>\n  </div>\n</div>'}),n("core/views/media-view",["ui/page-element","ui/logo-spinner","util/lang","ui/widget/textbox","text!layouts/media-view.html"],function(e,t,n,r,i){var s="Supports HTML5 video and YouTube",o=300,u=4;return function(a,f){function C(){p&&!d&&(k(!1),m.classList.remove("open"))}function k(e){e?(p=!1,m.style.width=N.width+"px",m.style.height=N.height+"px"):(m.style.width="",m.style.height="")}function L(e){r(e),e.addEventListener("blur",function(e){d=!1,C()},!1),e.addEventListener("focus",function(e){d=!0},!1)}function A(){var e=y.cloneNode(!0);e.classList.remove("fade-in"),x.appendChild(e),setTimeout(function(){e.classList.add("fade-in")},0),N&&(N.width=g.clientWidth,N.height=g.clientHeight,k(!0)),e.querySelector("button.butter-btn-remove").addEventListener("click",function(t){O(e)},!1),L(e.querySelector("input[type='text']")),x.querySelectorAll("input[type='text']").length>=u&&(S.style.visibility="hidden")}function O(e){x.removeChild(e),N.width=g.clientWidth,N.height=g.clientHeight,k(!0),x.querySelectorAll("input[type='text']").length<u&&(S.style.visibility="visible")}function M(e,t){e?w.innerHTML=t:w.innerHTML=s}function _(){var e=[],t=g.querySelectorAll("input[type='text']");w.classList.add("form-ok"),w.classList.remove("form-error");for(var n=0,r=t.length;n<r;n++)t[n].classList.add("form-ok"),t[n].classList.remove("form-error"),e.push(t[n].value);a.url=e}function D(e){var t=x.querySelectorAll("input[type='text']");while(t.length<e.length)A(),t=x.querySelectorAll("input[type='text']");while(t.length>e.length)O(t[t.length-1]),t=x.querySelectorAll("input[type='text']");for(var n=0;n<e.length;++n)t[n].value=e[n]}function P(){var e=a.url;if(typeof e=="string")b.value=e;else{if(!e.length)throw"Media url is expected value (not string or array): "+e;D(e)}}function H(e){var t=x.querySelectorAll("button.butter-btn-remove"),n=x.querySelectorAll("input[type='text']");for(var r=0;r<n.length;r++)n[r].disabled=e,t[r].disabled=e;d=e,S.disabled=e}function B(e){var t=e?e.data:c.element.getBoundingClientRect();m.style.left=t.left+"px",m.style.top=t.top+"px"}var l=a,c,h=f.onDropped||function(){},p=!1,d=!1,v,m=n.domFragment(i),g=m.querySelector("div.butter-container"),y=m.querySelector("div.butter-url"),b=m.querySelector("input[type='text']"),w=m.querySelector(".butter-form-field-notes"),E=m.querySelector("button.butter-btn-save"),S=m.querySelector("button.butter-btn-add-url"),x=m.querySelector("div.butter-url-group"),T=m.querySelector(".butter-loading-container"),N;S.addEventListener("click",function(e){A()},!1),L(b),m.addEventListener("mouseover",function(e){e.stopPropagation(),m.classList.add("open"),N||(N={width:g.clientWidth,height:g.clientHeight}),k(!0)},!0),m.addEventListener("mouseout",function(e){setTimeout(function(){C()},o),p=!0},!1),v=t(T),w.innerHTML=s,b.addEventListener("keypress",function(e){e.which===13&&_()},!1),E.addEventListener("click",_,!1),v.start(),E.setAttribute("disabled",!0),a.listen("mediacontentchanged",function(e){P(),M(!1),E.setAttribute("disabled",!0),H(!0),v.start()}),a.listen("mediafailed",function(e){M(!0,"Media failed to load. Check your URL."),E.removeAttribute("disabled"),H(!1),b.className+=" form-error",w.className+=" form-error",v.stop()}),a.listen("mediaready",function(e){M(!1),E.removeAttribute("disabled"),H(!1),v.stop()}),this.blink=function(){c.blink()},this.destroy=function(){c.destroy(),c=null},this.update=function(){P();var t=document.getElementById(l.target);c&&c.destroy(),c=new e(l.target,{drop:function(e){h(e)}},{highlightClass:"butter-media-highlight"}),t&&(m.parentNode||document.body.appendChild(m),c.listen("moved",B),B())}}}),function(){n("core/media",["core/logger","core/eventmanager","core/track","core/popcorn-wrapper","core/views/media-view"],function(e,t,n,r,i){var s=500,o=10,u=0,a=function(a){function T(e){S.dispatch("trackeventrequested",e)}function N(e){var t=e.data;x.updateEvent(t),t._popcornWrapper=x}function C(e){var t=e.data;x.destroyEvent(t),t._popcornWrapper=null}function k(){p&&p.indexOf(",")>-1&&(p=p.split(",")),p&&v&&x.prepare(p,v,b,S.popcornCallbacks,S.popcornScripts),E&&E.update()}function L(e){var t="";if(e.children){var n=e.children;t=[];for(var r=0,i=n.length;r<i;r++)n[r].nodeName==="SOURCE"&&t.push(n[r].src)}return t.length?t:e.currentSrc}a=a||{},t(this);var f=[],l="Media"+u++,c=new e(l),h=a.name||l,p=a.url,d=!1,v=a.target,m,g=0,y=0,b=a.popcornOptions,w,E,S=this,x=new r(l,{popcornEvents:{muted:function(){S.dispatch("mediamuted",S)},unmuted:function(){S.dispatch("mediaunmuted",S)},volumechange:function(){S.dispatch("mediavolumechange",x.volume)},timeupdate:function(){g=x.currentTime,S.dispatch("mediatimeupdate",S)},pause:function(){clearInterval(w),S.dispatch("mediapause")},playing:function(){w=setInterval(function(){g=x.currentTime},10),S.dispatch("mediaplaying")},ended:function(){S.dispatch("mediaended")}},prepare:function(){S.duration=x.duration,d=!0;for(var e=0,t=f.length;e<t;e++){var n=f[e].trackEvents;for(var r=0,i=n.length;r<i;r++)n[r].update()}E&&E.update();var s=document.getElementById(v);s&&s.getAttribute("data-butter-media-controls")&&x.popcorn.controls(!0),S.dispatch("mediaready")},constructing:function(){E&&E.update()},timeout:function(){S.dispatch("mediatimeout"),S.dispatch("mediafailed","timeout")},fail:function(e){S.dispatch("mediafailed","error")},playerTypeRequired:function(e){S.dispatch("mediaplayertyperequired",e)},setup:{target:v,url:p}});this.popcornCallbacks=null,this.popcornScripts=null,this.createView=function(){E||(E=new i(this,{onDropped:T}))},this.destroy=function(){x.unbind(),E&&E.destroy()},this.clear=function(){while(f.length>0)S.removeTrack(f[0])},this.addTrack=function(e){e instanceof n||(e=new n(e)),e.order=f.length,e._media=S,f.push(e),S.chain(e,["tracktargetchanged","trackeventadded","trackeventremoved","trackeventupdated","trackeventselected","trackeventdeselected","trackeventeditrequested"]),e.listen("trackeventadded",N),e.listen("trackeventremoved",C),S.dispatch("trackadded",e),e.setPopcornWrapper(x);var t=e.trackEvents;if(t.length>0)for(var r=0,i=t.length;r<i;++r)e.dispatch("trackeventadded",t[r]);return e},this.getTrackById=function(e){for(var t=0,n=f.length;t<n;++t)if(f[t].id===e)return f[t]},this.removeTrack=function(e){var t=f.indexOf(e);if(t>-1){f.splice(t,1);var n=e.trackEvents;for(var r=0,i=n.length;r<i;++r)n[r].selected=!1,e.dispatch("trackeventremoved",n[r]);return S.unchain(e,["tracktargetchanged","trackeventadded","trackeventremoved","trackeventupdated","trackeventselected","trackeventdeselected","trackeventeditrequested"]),e.setPopcornWrapper(null),e.unlisten("trackeventadded",N),e.unlisten("trackeventremoved",C),S.dispatch("trackremoved",e),e._media=null,e}},this.findTrackWithTrackEventId=function(e){for(var t=0,n=f.length;t<n;++t){var r=f[t].getTrackEventById(e);if(r)return{track:f[t],trackEvent:r}}},this.getManifest=function(e){return m[e]},this.setupContent=k,this.onReady=function(e){function t(n){e(n),S.unlisten("mediaready",t)}d?
e():S.listen("mediaready",t)},this.pause=function(){x.pause()},this.play=function(){x.play()},this.generatePopcornString=function(e,t){var n=b||{};e=e||S.popcornCallbacks,t=t||S.popcornScripts;var r=[];for(var i=0,s=f.length;i<s;++i)r=r.concat(f[i].trackEvents);return n.frameAnimation=!1,x.generatePopcornString(n,p,v,null,e,t,r)},Object.defineProperties(this,{ended:{enumerable:!0,get:function(){return x.popcorn?x.popcorn.ended():!1}},url:{enumerable:!0,get:function(){return p},set:function(e){p!==e&&(p=e,x.clear(v),k(),S.dispatch("mediacontentchanged",S))}},target:{get:function(){return v},set:function(e){v!==e&&(x.clear(v),v=e,k(),S.dispatch("mediatargetchanged",S))},enumerable:!0},muted:{enumerable:!0,get:function(){return x.muted},set:function(e){x.muted=e}},ready:{enumerable:!0,get:function(){return d}},name:{get:function(){return h},enumerable:!0},id:{get:function(){return l},enumerable:!0},tracks:{get:function(){return f},enumerable:!0},currentTime:{get:function(){return g},set:function(e){e!==undefined&&(g=e,g<0&&(g=0),g>y&&(g=y),x.currentTime=g,S.dispatch("mediatimeupdate",S))},enumerable:!0},duration:{get:function(){return y},set:function(e){e&&(y=e,c.log("duration changed to "+y),S.dispatch("mediadurationchanged",S))},enumerable:!0},json:{get:function(){var e=[];for(var t=0,n=f.length;t<n;++t)e.push(f[t].json);return{id:l,name:h,url:p,target:v,duration:y,controls:x.popcorn?x.popcorn.controls():!1,tracks:e}},set:function(e){e.name&&(h=e.name),e.target&&(S.target=e.target),e.url&&(S.url=e.url);if(e.tracks){var t=e.tracks;for(var r=0,i=t.length;r<i;++r){var s=new n;s.json=t[r],S.addTrack(s)}}},enumerable:!0},registry:{get:function(){return m},set:function(e){m=e},enumerable:!0},popcorn:{enumerable:!0,get:function(){return x}},paused:{enumerable:!0,get:function(){return x.paused},set:function(e){x.paused=e}},volume:{enumerable:!0,get:function(){return x.volume},set:function(e){x.volume=e}},view:{enumerable:!0,get:function(){return E}},popcornOptions:{enumerable:!0,get:function(){return b},set:function(e){b=e,S.dispatch("mediapopcornsettingschanged",S),k()}}});var A=document.getElementById(v),O=p,M=0,_;A&&["VIDEO","AUDIO"].indexOf(A.nodeName)>-1&&(O=O||L(A),O?p=O:_=setInterval(function(){O=L(A),O?(p=O,k(),clearInterval(_)):M++===o&&clearInterval(_)},s))};return a})}(),n("text!layouts/header.html",[],function(){return'<div id="butter-header" data-butter-exclude>\n  <div class="butter-header-inner">\n    <div class="butter-logo"></div>\n    <span class="butter-name"></span>\n    <div class="butter-editor-actions">\n      <a class="butter-btn" href="/dashboard" id="butter-header-load" title="Manage your projects"><span class="icon-grear-sign"></span> Projects</a>\n      <a class="butter-btn" href="#" id="butter-header-save" title="Save your project"><span class="icon-ok-sign"></span> Save</a>\n      <a class="butter-btn" href="#" id="butter-header-source" title="View the source of this template"><span class="icon-eye-open"></span> View Source</a>\n      <a class="butter-btn" href="#" id="butter-header-share" title="Generate a link to share this project with the world"><span class="icon-share-alt"></span> Publish</a>\n      <a class="butter-btn" href="#" id="butter-header-auth" title="Sign in or sign up with Persona"><span class=\'icon-user\'></span>Sign In / Sign Up</a>\n    </div>\n  </div>\n</div>\n'}),n("ui/header",["dialog/iframe-dialog","util/lang","text!layouts/header.html"],function(e,t,n){var r="<span class='icon-user'></span> Sign In / Sign Up",i="Sign in or sign up with Persona";return function(s,o){function p(e,t){if(s.cornfield.authenticated()&&e&&typeof e=="function"){e();return}s.cornfield.login(function(n){n.error?(d("There was an error logging in. Please try again."),t&&t()):s.cornfield.list(function(t){g(),e&&typeof e=="function"&&e()})})}function d(t,n){var r=new e({type:"iframe",modal:!0,url:s.ui.dialogDir+"error-message.html",events:{open:function(e){r.send("message",t)},cancel:function(e){r.close(),n&&n()}}});r.open()}function v(t){function n(){s.project.data=s.exportProject();var e=JSON.stringify(s.project,null,4);s.ui.loadIndicator.start(),s.cornfield.save(s.project.id,e,function(e){s.ui.loadIndicator.stop();if(e.error!=="okay"||!e.project||!e.project._id){d("There was a problem saving your project. Please try again.");return}s.project.id=e.project._id,t&&t()})}if(!s.project.name){var r=new e({type:"iframe",modal:!0,classes:"fade-in smallIframe",url:s.ui.dialogDir+"save-as.html",events:{open:function(e){r.send("name",null)},submit:function(e){s.project.name=e.data,r.close(),n()},cancel:function(e){r.close()}}});r.open()}else n()}function m(){s.cornfield.logout(y)}function g(){h.removeEventListener("click",p,!1),h.innerHTML="<span class='icon-user'></span> "+s.cornfield.name(),h.title="This is you!",h.addEventListener("click",m,!1)}function y(){h.removeEventListener("click",m,!1),h.innerHTML=r,h.title=i,h.addEventListener("click",p,!1)}o=o||{};var u=t.domFragment(n),a,f,l,c,h;a=u.querySelector(".butter-name"),a.innerHTML=o.value("title")||"Popcorn Maker",u=document.body.insertBefore(u,document.body.firstChild),f=document.getElementById("butter-header-save"),l=document.getElementById("butter-header-source"),c=document.getElementById("butter-header-share"),h=document.getElementById("butter-header-auth"),document.body.classList.add("butter-header-spacing"),l.addEventListener("click",function(t){var n={html:s.getHTML(),json:s.exportProject()},r=new e({type:"iframe",modal:!0,url:s.ui.dialogDir+"view-source.html",events:{open:function(){r.send("export",n)},cancel:function(e){r.close()}}});r.open()},!1),c.addEventListener("click",function(t){function n(){s.cornfield.publish(s.project.id,function(t){if(t.error!=="okay"){d("There was a problem saving your project. Please try again.");return}var n=t.url,r=new e({type:"iframe",modal:!0,classes:"fade-in smallIframe",url:s.ui.dialogDir+"share.html",events:{open:function(e){r.send("url",n)},cancel:function(e){r.close()}}});r.open()})}function r(){v(n)}p(r)},!1),f.addEventListener("click",function(e){p(v)},!1),s.cornfield.authenticated()?g():(y(),s.listen("autologinsucceeded",function b(e){s.unlisten("autologinsucceeded",b),g()}))}}),n("ui/ui",["core/eventmanager","./toggler","./logo-spinner","./context-button","./header"],function(e,t,n,r,i){function u(t,n){var r,i=[],s=this;e(s),this.element=r=n||document.createElement("div"),r.id=t,this.items={},this.addComponent=function(e,t){var n=new a(e,t);i.push(n),r.appendChild(n.element)},this.setContentState=function(e){for(var t=0,n=i.length;t<n;++t)i[t].setState(e)}}function a(e,t){t=t||{};var n=t.transitionIn||function(){},r=t.transitionInComplete||function(){},i=t.transitionOut||function(){},o=t.transitionOutComplete||function(){},u=t.states||[],a=!1;this.element=e,this.setState=function(e){(!u||u.indexOf(e)>-1)&&!a?(a=!0,n(),setTimeout(r,s)):a&&(i(),setTimeout(o,s),a=!1)}}function f(e,t){var n,r,i;for(n in e)e.hasOwnProperty(n)&&(r=new Image,r.id=n+"-icon",r.src=t+e[n],i=document.createElement("div"),i.setAttribute("data-butter-exclude","true"),i.className="butter-image-preload",i.appendChild(r),document.body.appendChild(i))}function p(a){var p={},d=[],v=!0,m,g=a.config,y=this;e(y),p.main=new u("butter-tray"),this.contentStateLocked=!1;var b=p.main.element,w=new t(a,b);b.setAttribute("data-butter-exclude","true"),b.className="butter-tray",p.work=new u("work"),p.statusbar=new u("status-bar"),p.tools=new u("tools");var E=document.createElement("div");E.id="butter-loading-container",m=n(E),b.appendChild(E),b.appendChild(p.statusbar.element),b.appendChild(p.work.element),b.appendChild(p.tools.element),g.value("ui").enabled!==!1&&(document.body.classList.add("butter-header-spacing"),document.body.classList.add("butter-tray-spacing"),document.body.appendChild(b),a.listen("mediaadded",function(e){e.data.createView()})),this.load=function(e){g.value("ui").enabled!==!1?a.loader.load([{type:"css",url:o}],function(){f(g.value("icons"),g.value("dirs").resources||""),e()}):e()},this.registerStateToggleFunctions=function(e,t){y.listen("contentstatechanged",function(n){n.data.oldState===e&&t.transitionOut(n),n.data.newState===e&&t.transitionIn(n)})},this.pushContentState=function(e){if(y.contentStateLocked)return;var t=y.contentState;d.push(e),b.setAttribute("data-butter-content-state",y.contentState);for(var n in p)p.hasOwnProperty(n)&&p[n].setContentState(e);y.dispatch("contentstatechanged",{oldState:t,newState:y.contentState})},this.popContentState=function(){if(y.contentStateLocked)return;var e=d.pop(),t=y.contentState;b.setAttribute("data-butter-content-state",t);for(var n in p)p.hasOwnProperty(n)&&p[n].setContentState(t);return y.dispatch("contentstatechanged",{oldState:e,newState:t}),e},this.setContentState=function(e){var t=d.pop();d=[e],b.setAttribute("data-butter-content-state",e);for(var n in p)p.hasOwnProperty(n)&&p[n].setContentState(e);return y.dispatch("contentstatechanged",{oldState:t,newState:e}),t},Object.defineProperties(this,{contentState:{configurable:!1,enumerable:!0,get:function(){return d.length>0?d[d.length-1]:null}},element:{configurable:!1,enumerable:!0,get:function(){return b}},areas:{configurable:!1,enumerable:!0,get:function(){return p}},visible:{enumerable:!0,get:function(){return v},set:function(e){v!==e&&(v=e,v?(document.body.classList.remove("minimized"),b.setAttribute("ui-state","visible"),y.dispatch("uivisibilitychanged",!0)):(document.body.classList.add("minimized"),b.setAttribute("ui-state","hidden"),y.dispatch("uivisibilitychanged",!1)))}}});var S=a.orderedTrackEvents=[],x=function(e,t){return e.popcornOptions.start>t.popcornOptions.start};a.listen("trackeventadded",function(e){S.push(e.data),S.sort(x)}),a.listen("trackeventremoved",function(e){var t=S.indexOf(e.data);t>-1&&S.splice(t,1)}),a.listen("trackeventupdated",function(e){S.sort(x)});var T=a.orderedTracks=[],N=function(e,t){return e.order>t.order};a.listen("trackadded",function(e){e.data.listen("trackorderchanged",function(e){T.sort(N)}),T.push(e.data),T.sort(N)}),a.listen("trackremoved",function(e){var t=T.indexOf(e.data);t>-1&&T.splice(t,1)});var C={32:function(e){e.preventDefault(),a.currentMedia.ended?a.currentMedia.paused=!1:a.currentMedia.paused=!a.currentMedia.paused},37:function(e){var t=e.shiftKey?h:c;if(a.selectedEvents.length){e.preventDefault();for(var n=0,r=a.selectedEvents.length;n<r;n++)a.selectedEvents[n].moveFrameLeft(t,e.ctrlKey||e.metaKey)}else a.currentTime-=t},38:function(e){var t,n,r;a.selectedEvents.length&&e.preventDefault();for(var i=0,s=a.selectedEvents.length;i<s;i++)n=a.selectedEvents[i],t=n.track,r=T[T.indexOf(t)-1],r&&(t.removeTrackEvent(n),r.addTrackEvent(n))},39:function(e){e.preventDefault();var t=e.shiftKey?h:c;if(a.selectedEvents.length)for(var n=0,r=a.selectedEvents.length;n<r;n++)a.selectedEvents[n].moveFrameRight(t,e.ctrlKey||e.metaKey);else a.currentTime+=t},40:function(e){var t,n,r;a.selectedEvents.length&&e.preventDefault();for(var i=0,s=a.selectedEvents.length;i<s;i++)n=a.selectedEvents[i],t=n.track,r=T[T.indexOf(t)+1],r&&(t.removeTrackEvent(n),r.addTrackEvent(n))},27:function(e){for(var t=0;t<a.selectedEvents.length;t++)a.selectedEvents[t].selected=!1;a.selectedEvents=[]},8:function(e){if(a.selectedEvents.length){e.preventDefault();for(var t=0;t<a.selectedEvents.length;t++)a.selectedEvents[t].track.removeTrackEvent(a.selectedEvents[t]);a.selectedEvents=[]}},9:function(e){if(S.length&&a.selectedEvents.length<=1){e.preventDefault();var t=0,n=e.shiftKey?-1:1;S.indexOf(a.selectedEvents[0])>-1&&(t=S.indexOf(a.selectedEvents[0]),S[t+n]?t+=n:e.shiftKey?t=S.length-1:t=0);for(var r=0;r<a.selectedEvents.length;r++)a.selectedEvents[r].selected=!1;a.selectedEvents=[],S[t].selected=!0,a.selectedEvents.push(S[t])}}};window.addEventListener("keydown",function(e){var t=e.which||e.keyCode;t=t===46?8:t,C[t]&&l.indexOf(e.target.nodeName)===-1&&C[t](e)},!1),this.TRANSITION_DURATION=s,w.visible=!1,y.visible=!1,this.loadIndicator={start:function(){m.start(),E.style.display="block"},stop:function(){m.stop(function(){E.style.display="none"})}},y.loadIndicator.start(),a.listen("ready",function(){y.loadIndicator.stop(),y.visible=!0,w.visible=!0,r(a),g.value("ui").enabled!==!1&&i(a,g)}),y.dialogDir=a.config.value("dirs").dialogs||""}var s=500,o="{css}/butter.ui.css",l=["TEXTAREA","INPUT","VIDEO","AUDIO"],c=.25,h=1;return p.__moduleName="ui",p}),function(){var e=1,t=.01,r={Chrome:17,Firefox:10};n("main",["core/eventmanager","core/logger","core/config","core/target","core/media","core/page","./modules","./dependencies","ui/ui","util/xhr","util/lang","text!default-config.json","text!layouts/ua-warning.html"],function(n,i,s,o,u,a,f,l,c,h,p,d,v){function b(p){function F(){if(!T)throw new Error("No media object is selected")}function I(n,r,i){var s,o=n.getAttribute("data-butter-plugin-type"),u=r.currentTime,a;u>r.duration&&(u=r.duration-e),u<0&&(u=0),a=u+e,a>r.duration&&(a=r.duration);if(!o){k.log("Invalid trackevent type requested.");return}r.tracks.length===0&&r.addTrack(),s=r.tracks[0];var f=s.addTrackEvent({type:o,popcornOptions:{start:u,end:a,target:i}});return r.currentTime<r.duration-t&&(r.currentTime+=t),f}function q(e){if(T){var t=I(e.data.element,T,e.target.elementID);_.dispatch("trackeventcreated",{trackEvent:t,by:"target"})}else k.log("Warning: No media to add dropped trackevent.")}function R(e){L.addPlayerType(e.data)}function U(e){var t=I(e.data,e.target,T.target);_.dispatch("trackeventcreated",{trackEvent:t,by:"media"})}function X(e){var t;window.location.search.substring(1).split("&").forEach(function(e){e=e.split("="),e&&e[0]==="savedDataUrl"&&(t=e[1])}),t=t||A.value("savedDataUrl");if(t){var n=new XMLHttpRequest,r;t+="?noCache="+Date.now(),n.open("GET",t,!1),n.overrideMimeType&&n.overrideMimeType("application/json"),n.setRequestHeader("If-Modified-Since","Fri, 01 Jan 1960 00:00:00 GMT"),n.send(null);if(n.status===200){try{r=JSON.parse(n.responseText)}catch(i){_.dispatch("loaddataerror","Saved data not formatted properly.")}_.project.id=r.projectID,_.project.name=r.name,_.importProject(r)}else k.log("Butter saved data not found: "+t)}e()}function V(e){e&&O.merge(e),A=O,_.project.template=A.value("name");var t=f(_,A),n=l(A);_.loader=n,L=new a(n,A),_.ui=new c(_),_.ui.load(function(){W(function(){z(function(){t.ready(function(){A.value("snapshotHTMLOnReady")&&L.snapshotHTML(),X(function(){_.dispatch("ready",_)})})})})})}var v=navigator.userAgent,b;for(var w in r)if(r.hasOwnProperty(w)){var E=new RegExp(w+"/([0-9]+)\\.","g"),S=E.exec(v);S&&S.length===2&&Number(S[1])>=r[w]&&(b=w+"/"+S[1])}b||y.showUAWarning(),p=p||{};var x=[],T,N=[],C="Butter"+m++,k=new i(C),L,A,O,M,_=this,D=[],P={},H={},B={};try{O=s.parse(d)}catch(j){throw"Butter Error: unable to find or parse default-config.json"}p.debug!==undefined&&i.enabled(p.debug),n(_),this.project={id:null,name:null,data:null,html:null,template:null,customData:null},Object.defineProperty(this.project,"customData",{get:function(){return H}}),this.getManifest=function(e){return F(),T.getManifest(e)},this.getHTML=function(){var e=[];for(var t=0;t<x.length;++t)e.push(x[t].generatePopcornString());return L.getHTML(e)},this.addTarget=function(e){return e instanceof o||(e=new o(e)),N.push(e),e.listen("trackeventrequested",q),k.log("Target added: "+e.name),_.dispatch("targetadded",e),e.isDefault&&(M=e),e},this.removeTarget=function(e){typeof e=="string"&&(e=_.getTargetByType("id",e));var t=N.indexOf(e);return t>-1?(e.unlisten("trackeventrequested",q),N.splice(t,1),delete N[e.name],_.dispatch("targetremoved",e),M===e&&(M=undefined),e):undefined},this.serializeTargets=function(){var e=[];for(var t=0,n=N.length;t<n;++t)e.push(N[t].json);return e},this.getTargetByType=function(e,t){for(var n=0,r=N.length;n<r;n++)if(N[n][e]===t)return N[n];return undefined},this.importProject=function(e){var t,n;if(e.targets)for(t=0,n=e.targets.length;t<n;++t){var r,i=_.targets,s=e.targets[t];for(var o=0,a=i.length;o<a;++o)if(i[o].name===s.name){r=i[o];break}r?r.json=s:_.addTarget(s)}if(e.media)for(t=0,n=e.media.length;t<n;++t){var f=e.media[t],l=_.getMediaByType("target",f.target);l?l.json=f:(l=new u,l.json=f,_.addMedia(l))}},this.exportProject=function(){var e=[];for(var t=0,n=x.length;t<n;++t)e.push(x[t].json);var r={targets:_.serializeTargets(),media:e};return r},this.clearProject=function(){var e=this.orderedTrackEvents;while(e.length>0)e[0].track.removeTrackEvent(e[0]);while(N.length>0)N[0].destroy(),_.removeTarget(N[0]);while(x.length>0)x[0].destroy(),_.removeMedia(x[0])},this.getMediaByType=function(e,t){for(var n=0,r=x.length;n<r;n++)if(x[n][e]===t)return x[n];return undefined},this.addMedia=function(e){e instanceof u||(e=new u(e)),e.popcornCallbacks=B,e.popcornScripts=P,x.push(e),_.chain(e,["mediacontentchanged","mediadurationchanged","mediatargetchanged","mediatimeupdate","mediaready","trackadded","trackremoved","tracktargetchanged","trackeventadded","trackeventremoved","trackeventupdated","trackeventeditrequested"]);var t;if(e.tracks.length>0)for(var n=0,r=e.tracks.length;n<r;++n){var i=e.tracks[n];t=i.trackEvents,e.dispatch("trackadded",i);if(t.length>0)for(var s=0,o=t.length;s<o;++s)i.dispatch("trackeventadded",t[s])}return e.listen("trackeventrequested",U),e.listen("mediaplayertyperequired",R),_.dispatch("mediaadded",e),T||(_.currentMedia=e),e.setupContent(),e},this.removeMedia=function(e){var t=x.indexOf(e);if(t>-1){x.splice(t,1),_.unchain(e,["mediacontentchanged","mediadurationchanged","mediatargetchanged","mediatimeupdate","mediaready","trackadded","trackremoved","tracktargetchanged","trackeventadded","trackeventremoved","trackeventupdated","trackeventeditrequested"]);var n=e.tracks;for(var r=0,i=n.length;r<i;++r)_.dispatch("trackremoved",n[r]);return e===T&&(T=undefined),e.unlisten("trackeventrequested",U),e.unlisten("mediaplayertyperequired",R),_.dispatch("mediaremoved",e),e}return undefined},this.extend=function(){y.extend(_,[].slice.call(arguments,1))},Object.defineProperties(_,{defaultTarget:{enumerable:!0,get:function(){return M}},config:{enumerable:!0,get:function(){return A}},id:{get:function(){return C},enumerable:!0},tracks:{get:function(){return T.tracks},enumerable:!0},targets:{get:function(){return N},enumerable:!0},currentTime:{get:function(){return F(),T.currentTime},set:function(e){F(),T.currentTime=e},enumerable:!0},duration:{get:function(){return F(),T.duration},set:function(e){F(),T.duration=e},enumerable:!0},media:{get:function(){return x},enumerable:!0},currentMedia:{get:function(){return T},set:function(e){typeof e=="string"&&(e=_.getMediaByType("id",e.id));if(e&&x.indexOf(e)>-1)return T=e,k.log("Media Changed: "+e.name),_.dispatch("mediachanged",e),T},enumerable:!0},selectedEvents:{get:function(){return D},set:function(e){D=e},enumerable:!0},debug:{get:function(){return i.enabled()},set:function(e){i.enabled(e)},enumerable:!0}});var z=this.preparePage=function(e){var t=L.scrape(),n=t.target,r=t.media;L.prepare(function(){if(!!A.value("scrapePage")){var t,i,s,o,u,a,f,l,c;for(t=0,s=n.length;t<s;++t){a=null;if(N.length>0)for(i=0,o=N.length;i<o;++i)if(N[i].id===n[t].id){a=N[i];break}a||_.addTarget({element:n[t].id})}for(t=0,s=r.length;t<s;t++){f=null,l=null,u="",c=r[t],c.getAttribute("data-butter-source")&&(u=c.getAttribute("data-butter-source"));if(x.length>0){for(i=0,o=x.length;i<o;++i)if(x[i].id!==r[t].id&&x[i].url!==u){f=x[i];break}}else A.value("mediaDefaults")&&(l=A.value("mediaDefaults"));f||_.addMedia({target:r[t].id,url:u,popcornOptions:l})}}e&&e(),_.dispatch("pageready")})};g.push(this),p.ready&&_.listen("ready",function(e){p.ready(e.data)});var W=this.preparePopcornScriptsAndCallbacks=function(e){function o(t){return function(n){this.readyState===4&&(this.status!==200?(P[t]="",k.log("WARNING: Trouble loading Popcorn script: "+this.response)):P[t]=this.response,++s,s===i.length&&e&&e())}}var t=A.value("popcorn")||{},n=t.callbacks,r=t.scripts,i=[],s=0;B=n;for(var u in r)if(r.hasOwnProperty(u)){var a=r[u],f=document.getElementById(a.substring(1));a.indexOf("#")===0?f&&(P[u]=f.innerHTML):i.push({url:a,onLoad:o(u)})}if(i.length>0)for(var l=0;l<i.length;++l)h.get(i[l].url,i[l].onLoad);else e()};if(p.config&&typeof p.config=="string"){var $=new XMLHttpRequest,J,K=p.config+"?noCache="+Date.now();$.open("GET",K,!1),$.overrideMimeType&&$.overrideMimeType("application/json"),$.setRequestHeader("If-Modified-Since","Fri, 01 Jan 1960 00:00:00 GMT"),$.send(null);if($.status===200||$.status===0){try{J=s.parse($.responseText)}catch(j){throw new Error("Butter config file not formatted properly.")}V(J)}else _.dispatch("configerror",_)}else V(p.config);this.page=L}var m=0,g=[],y=function(e){return new b(e)};y.showUAWarning=function(){var e=p.domFragment(v);document.body.appendChild(e),e.classList.add("slide-out"),e.getElementsByClassName("close-button")[0].onclick=function(){document.body.removeChild(e)}},y.instances=g,y.version="storycamp";if(window.Butter.__waiting){for(var w=0,E=window.Butter.__waiting.length;w<E;++w)y.apply({},window.Butter.__waiting[w]);delete y._waiting}return window.Butter=y,y})}()})();